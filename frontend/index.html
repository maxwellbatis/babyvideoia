<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baby Diary - Painel Criativo</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card h2 i {
            font-size: 1.8rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .result {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .result h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .result p {
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .copy-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            cursor: pointer;
            margin-top: 10px;
            transition: background 0.3s ease;
        }

        .copy-btn:hover {
            background: #218838;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading i {
            font-size: 2rem;
            color: #667eea;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .video-preview {
            margin-top: 20px;
            text-align: center;
        }

        .video-preview video {
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .social-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .social-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .social-btn:hover {
            transform: translateY(-2px);
        }

        .instagram { background: #e4405f; color: white; }
        .facebook { background: #1877f2; color: white; }
        .tiktok { background: #000; color: white; }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-header h2 {
            color: #667eea;
            margin: 0;
            font-size: 1.8rem;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #667eea;
        }

        .save-cred-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .save-cred-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
        }

        .check-credits-btn {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin-left: 5px;
        }

        .check-credits-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(23, 162, 184, 0.3);
        }

        .check-credits-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .cred-status {
            font-size: 0.85rem;
            font-weight: 500;
            min-width: 80px;
        }

        .cred-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 20px;
        }

        .cred-input-group input {
            flex: 1;
        }

        .cred-input-group button {
            white-space: nowrap;
        }

        /* Estilos para M√∫sica de Fundo */
        .music-selector {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }

        .selected-file-name {
            font-size: 0.9rem;
            color: #666;
            font-style: italic;
        }

        .music-settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .setting-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .setting-item label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #495057;
        }

        .setting-item input[type="range"] {
            width: 100%;
        }

        .setting-item span {
            font-size: 0.85rem;
            color: #6c757d;
            text-align: center;
        }

        .setting-item input[type="checkbox"] {
            margin-right: 8px;
        }

        /* Estilos para Biblioteca de M√∫sicas */
        .music-categories {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .music-category-btn {
            padding: 8px 16px;
            border: 2px solid #e9ecef;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .music-category-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .music-category-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .music-library {
            max-height: 400px;
            overflow-y: auto;
        }

        .music-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .music-item:hover {
            background: #f8f9ff;
            border-color: #667eea;
        }

        .music-item.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .music-item-icon {
            font-size: 1.5em;
            margin-right: 12px;
        }

        .music-item-info {
            flex: 1;
        }

        .music-item-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .music-item-category {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .music-item-size {
            font-size: 0.8rem;
            color: #6c757d;
        }

        .music-item-actions {
            display: flex;
            gap: 8px;
            margin-left: auto;
            margin-right: 15px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.85rem;
            border-radius: 6px;
            min-width: 40px;
        }

        /* Galeria de V√≠deos */
        .video-gallery {
            margin-top: 20px;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .video-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .video-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .video-thumbnail {
            position: relative;
            width: 100%;
            height: 160px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3em;
            overflow: hidden;
            border-radius: 8px 8px 0 0;
        }

        .video-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-thumbnail video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .video-card:hover .video-overlay {
            opacity: 1;
        }

        .video-overlay i {
            font-size: 2.5em;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .video-info {
            padding: 15px;
        }

        .video-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .video-hashtags {
            font-size: 0.8rem;
            color: #667eea;
            margin-bottom: 8px;
            line-height: 1.3;
        }

        .video-caption {
            font-size: 0.85rem;
            color: #666;
            margin-top: 8px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 3px solid #667eea;
            line-height: 1.4;
            max-height: 80px;
            overflow-y: auto;
        }

        .video-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: #666;
        }

        .video-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .video-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            text-align: center;
        }

        .video-btn.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .video-btn.secondary {
            background: #f8f9fa;
            color: #666;
            border: 1px solid #e9ecef;
        }

        .video-btn.tiktok {
            background: linear-gradient(135deg, #000000 0%, #25f4ee 50%, #fe2c55 100%);
            color: white;
            border: 1px solid #25f4ee;
        }

        .video-btn.tiktok:hover {
            background: linear-gradient(135deg, #25f4ee 0%, #fe2c55 50%, #000000 100%);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(37, 244, 238, 0.3);
        }

        .video-btn.tiktok.posted {
            background: #28a745;
            border-color: #28a745;
        }

        .video-btn.tiktok.posted:hover {
            background: #218838;
        }

        .video-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* Chat IA Styles */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: calc(80vh - 120px);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .message {
            display: flex;
            margin-bottom: 20px;
            align-items: flex-start;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .bot-message .message-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .user-message .message-avatar {
            background: #28a745;
            color: white;
        }

        .message-content {
            flex: 1;
            background: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            max-width: 80%;
        }

        .bot-message .message-content {
            border-bottom-left-radius: 5px;
        }

        .user-message .message-content {
            border-bottom-right-radius: 5px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .message-content p {
            margin: 0 0 10px 0;
            line-height: 1.5;
        }

        .message-content ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .message-content li {
            margin-bottom: 5px;
        }

        .chat-input-container {
            border-top: 1px solid #e9ecef;
            padding-top: 20px;
        }

        .quick-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .quick-btn {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .quick-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .chat-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-input-group input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 25px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .chat-input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .chat-input-group button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s ease;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-input-group button:hover {
            transform: scale(1.1);
        }

        .chat-input-group button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .suggestion-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .suggestion-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .suggestion-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .suggestion-card h4 {
            color: #667eea;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .suggestion-card p {
            font-size: 0.85rem;
            color: #666;
            margin: 0;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 10px;
            color: #666;
            font-style: italic;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #667eea;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        .empty-gallery {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-gallery i {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        /* Modal de Visualiza√ß√£o de V√≠deo */
        .video-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            overflow-y: auto;
            overflow-x: hidden;
        }

        .video-modal-content {
            position: relative;
            margin: 2% auto;
            width: 90%;
            max-width: 800px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-height: 90vh;
            overflow-y: auto;
        }

        .video-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .video-modal-header h3 {
            margin: 0;
            color: #333;
        }

        .video-modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            padding: 5px;
        }

        .video-modal-body {
            padding: 20px;
            max-height: calc(90vh - 120px);
            overflow-y: auto;
        }

        .video-modal-video {
            width: 100%;
            border-radius: 8px;
            margin-bottom: 20px;
            max-height: 60vh;
            object-fit: contain;
        }

        .video-modal-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .card {
                padding: 20px;
            }

            .modal-content {
                margin: 10% auto;
                padding: 20px;
                width: 95%;
            }

            .cred-input-group {
                flex-direction: column;
                align-items: stretch;
            }

            .cred-input-group button {
                align-self: flex-start;
            }

            /* Estilos responsivos para o modal de v√≠deo */
            .video-modal-content {
                margin: 5% auto;
                width: 95%;
                max-height: 95vh;
            }

            .video-modal-body {
                padding: 15px;
                max-height: calc(95vh - 100px);
            }

            .video-modal-video {
                max-height: 50vh;
            }

            .video-modal-actions {
                flex-direction: column;
                gap: 8px;
            }

            .video-modal-actions .video-btn {
                width: 100%;
                text-align: center;
            }
        }

        /* Estilos para Galeria de Imagens do App */
        .app-image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .app-image-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .app-image-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .app-image-card.selected {
            border: 3px solid #667eea;
            transform: scale(1.02);
        }

        .app-image-thumbnail {
            width: 100%;
            height: 150px;
            object-fit: cover;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .app-image-info {
            padding: 15px;
        }

        .app-image-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
            font-size: 0.9rem;
        }

        .app-image-tag {
            display: inline-block;
            padding: 2px 8px;
            background: #667eea;
            color: white;
            border-radius: 12px;
            font-size: 0.75rem;
            margin-bottom: 8px;
        }

        .app-image-description {
            font-size: 0.8rem;
            color: #666;
            line-height: 1.4;
            margin-bottom: 10px;
        }

        .app-image-actions {
            display: flex;
            gap: 5px;
        }

        .app-image-btn {
            flex: 1;
            padding: 6px 10px;
            border: none;
            border-radius: 5px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .app-image-btn.primary {
            background: #667eea;
            color: white;
        }

        .app-image-btn.primary:hover {
            background: #5a6fd8;
        }

        .app-image-btn.danger {
            background: #dc3545;
            color: white;
        }

        .app-image-btn.danger:hover {
            background: #c82333;
        }

        .app-image-btn.secondary {
            background: #6c757d;
            color: white;
        }

        .app-image-btn.secondary:hover {
            background: #5a6268;
        }

        /* Se√ß√£o de Status das APIs */
        .config-section {
          margin-top: 30px;
          padding: 20px;
          background: #f8f9fa;
          border-radius: 10px;
        }

        .config-section h3 {
          color: #667eea;
          margin-bottom: 15px;
        }

        .api-status-container {
          display: flex;
          flex-direction: column;
          gap: 15px;
        }

        .api-buttons {
          display: flex;
          gap: 10px;
          justify-content: center;
        }

        .api-status-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 15px;
        }

        .api-status-item {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 10px;
          background: white;
          border-radius: 5px;
          box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .api-name {
          font-weight: 600;
          color: #333;
        }

        .api-indicator {
          font-size: 0.9rem;
          color: #666;
        }

        .api-usage {
          font-size: 0.8rem;
          color: #888;
          margin-top: 5px;
          padding: 5px;
          background: #f8f9fa;
          border-radius: 3px;
          border-left: 3px solid #007bff;
        }

        .api-status-item {
          display: flex;
          flex-direction: column;
          padding: 15px;
          background: white;
          border-radius: 5px;
          box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .api-status-item .api-name {
          font-weight: 600;
          color: #333;
          margin-bottom: 5px;
        }

        .api-summary {
          margin-top: 15px;
          font-size: 0.9rem;
          color: #666;
        }

        .btn-secondary {
          background: #6c757d;
          color: white;
          border: none;
          padding: 8px 15px;
          border-radius: 15px;
          font-size: 0.9rem;
          cursor: pointer;
          transition: background 0.3s ease;
        }

        .btn-secondary:hover {
          background: #5a6268;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-baby"></i> Baby Diary</h1>
            <p>Painel Criativo - Gere conte√∫do incr√≠vel para seu beb√™</p>
        </div>

        <div class="dashboard">
            <!-- Card 5: Gerador de V√≠deos (MELHORADO) -->
            <div class="card">
                <h2><i class="fas fa-video"></i> Gerador de V√≠deos</h2>
                <form id="videoForm">
                    <div class="form-group">
                        <label for="videoTema">Tema do V√≠deo:</label>
                        <input type="text" id="videoTema" placeholder="Ex: Dicas para amamenta√ß√£o" required>
                    </div>
                    <!-- Bloco do Chat IA integrado -->
                    <div class="chat-ia-bloco" style="margin-bottom: 25px;">
                        <div class="chat-container" style="background: #f8f9fa; border-radius: 12px; padding: 18px 12px; box-shadow: 0 2px 8px rgba(102,126,234,0.07);">
                            <div class="chat-messages" id="chatMessages">
                                <div class="message bot-message">
                                    <div class="message-avatar">
                                        <i class="fas fa-robot"></i>
                                    </div>
                                    <div class="message-content">
                                        <p>Ol√°! Pe√ßa sugest√µes de temas para v√≠deos e clique para preencher o campo acima:</p>
                                        <ul>
                                            <li>üí° Temas criativos para v√≠deos</li>
                                            <li>üé¨ An√∫ncios do Baby Diary</li>
                                            <li>üìö Educativos sobre maternidade</li>
                                            <li>üì± Posts para redes sociais</li>
                                            <li>üí∞ Campanhas de vendas</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="chat-input-container">
                                <div class="quick-suggestions">
                                    <button class="quick-btn" onclick="sendQuickMessage('Sugira temas para an√∫ncios do Baby Diary')">
                                        üé¨ An√∫ncios
                                    </button>
                                    <button class="quick-btn" onclick="sendQuickMessage('Temas para v√≠deos educativos')">
                                        üìö Educativos
                                    </button>
                                    <button class="quick-btn" onclick="sendQuickMessage('Ideias para posts do Instagram')">
                                        üì± Posts Instagram
                                    </button>
                                    <button class="quick-btn" onclick="sendQuickMessage('Temas para campanha de vendas')">
                                        üí∞ Vendas
                                    </button>
                                </div>
                                <div class="chat-input-group">
                                    <input type="text" id="chatInput" placeholder="Pe√ßa sugest√µes de temas para v√≠deos..." maxlength="500">
                                    <button type="button" id="sendChatBtn" onclick="sendChatMessage()">
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="videoTipo">Tipo de V√≠deo: <i class="fas fa-info-circle" style="color: #667eea; cursor: help;" title="Clique para ver a estrutura de cada tipo"></i></label>
                        <select id="videoTipo" required onchange="showTipoInfo()">
                            <option value="anuncio">üì¢ An√∫ncio/Publicidade (30-60s)</option>
                            <option value="dica">üí° Dica R√°pida (15-30s)</option>
                            <option value="educativo">üìö Educativo (60-90s)</option>
                            <option value="story">üì± Story/Reels (15-30s)</option>
                            <option value="tutorial">üéØ Tutorial (45-90s)</option>
                            <option value="inspiracional">‚ú® Inspiracional (30-60s)</option>
                        </select>
                        <div id="tipoInfo" class="tipo-info" style="display: none; margin-top: 10px; padding: 12px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #667eea; font-size: 0.9em; color: #555;">
                            <strong id="tipoNome"></strong><br>
                            <span id="tipoEstrutura"></span><br>
                            <span id="tipoObjetivo"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="videoDuracaoTotal">Dura√ß√£o Total do V√≠deo:</label>
                        <select id="videoDuracaoTotal" required>
                            <option value="15">‚è±Ô∏è 15 segundos (muito r√°pido)</option>
                            <option value="30" selected>‚è±Ô∏è 30 segundos (an√∫ncio padr√£o)</option>
                            <option value="45">‚è±Ô∏è 45 segundos (m√©dio)</option>
                            <option value="60">‚è±Ô∏è 60 segundos (1 minuto)</option>
                            <option value="90">‚è±Ô∏è 90 segundos (1.5 minutos)</option>
                            <option value="120">‚è±Ô∏è 120 segundos (2 minutos)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="videoPublico">P√∫blico-Alvo:</label>
                        <select id="videoPublico" required>
                            <optgroup label="üë©‚Äçüëß‚Äçüë¶ P√∫blico Principal (M√£es)">
                                <option value="maes">üë∂ M√£es de primeira viagem</option>
                                <option value="gestantes">ü§∞ Gestantes</option>
                                <option value="maes_experientes">üë©‚Äçüëß‚Äçüë¶ M√£es experientes</option>
                                <option value="pais">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Pais em geral</option>
                                <option value="familiares">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familiares</option>
                            </optgroup>
                            <optgroup label="üíº P√∫blico SaaS White Label">
                                <option value="influenciadoras">üì± Influenciadoras digitais</option>
                                <option value="afiliados">ü§ù Afiliados e parceiros</option>
                                <option value="infoprodutores">üìö Criadores de infoprodutos</option>
                                <option value="empreendedores">üöÄ Empreendedores</option>
                                <option value="agencias">üè¢ Ag√™ncias de marketing</option>
                                <option value="consultores">üíº Consultores e coaches</option>
                                <option value="revendedores">üõí Revendedores</option>
                                <option value="startups">‚ö° Startups</option>
                                <option value="profissionais">üë®‚Äçüíº Profissionais liberais</option>
                                <option value="educadores">üë®‚Äçüè´ Educadores</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="videoFormato">Formato do V√≠deo:</label>
                        <select id="videoFormato" required>
                            <option value="aiimage">üé® AI Image (Imagens IA + Anima√ß√£o)</option>
                            <option value="images">üñºÔ∏è Images (Imagens Est√°ticas)</option>
                            <option value="kling">‚ú® Kling (Anima√ß√£o Avan√ßada)</option>
                            <option value="sd">üß¨ Stable Diffusion (SD)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="videoCenas">N√∫mero de Cenas:</label>
                        <input type="range" id="videoCenas" min="3" max="10" value="5" class="range-slider">
                        <span id="cenasValue">5 cenas</span>
                    </div>

                    <div class="form-group">
                        <label for="videoAspecto">Aspecto do V√≠deo:</label>
                        <select id="videoAspecto">
                            <option value="landscape">üì∫ Landscape (16:9)</option>
                            <option value="portrait">üì± Portrait (9:16)</option>
                            <option value="square">‚¨ú Square (1:1)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="videoEstilo">Estilo Visual:</label>
                        <select id="videoEstilo">
                            <option value="moderno">üé® Moderno</option>
                            <option value="classico">üìö Cl√°ssico</option>
                            <option value="colorido">üåà Colorido</option>
                            <option value="minimalista">‚ö™ Minimalista</option>
                        </select>
                    </div>
                    
                    <!-- Configura√ß√µes de M√∫sica de Fundo -->
                    <div class="form-group">
                        <label for="backgroundMusic">üéµ M√∫sica de Fundo (Opcional):</label>
                        <div class="music-selector">
                            <button type="button" class="btn btn-secondary" onclick="document.getElementById('backgroundMusic').click()">
                                <i class="fas fa-upload"></i> Upload de M√∫sica
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="showMusicLibrary()">
                                <i class="fas fa-music"></i> Biblioteca de M√∫sicas
                            </button>
                            <span id="selectedMusicName" class="selected-file-name">Nenhum arquivo selecionado</span>
                        </div>
                        <input type="file" id="backgroundMusic" accept="audio/*" style="display: none;">
                    </div>
                    
                    <div class="form-group" id="musicSettings" style="display: none;">
                        <label>‚öôÔ∏è Configura√ß√µes da M√∫sica:</label>
                        <div class="music-settings-grid">
                            <div class="setting-item">
                                <label for="musicVolume">Volume:</label>
                                <input type="range" id="musicVolume" min="0.1" max="1" step="0.1" value="0.3" class="range-slider">
                                <span id="volumeValue">30%</span>
                            </div>
                            <div class="setting-item">
                                <label for="musicFadeIn">Fade In (segundos):</label>
                                <input type="range" id="musicFadeIn" min="0" max="5" step="0.5" value="2" class="range-slider">
                                <span id="fadeInValue">2s</span>
                            </div>
                            <div class="setting-item">
                                <label for="musicFadeOut">Fade Out (segundos):</label>
                                <input type="range" id="musicFadeOut" min="0" max="5" step="0.5" value="2" class="range-slider">
                                <span id="fadeOutValue">2s</span>
                            </div>
                            <div class="setting-item">
                                <label>
                                    <input type="checkbox" id="musicLoop" checked>
                                    üîÑ Loop da m√∫sica
                                </label>
                            </div>
                        </div>
                    </div>
                    <!-- [1] Adicionar campo visual para imagens selecionadas no formul√°rio de v√≠deo -->
                    <div class="form-group" id="selectedAppImagesPreview" style="display: none;">
                        <label>Imagens do App Selecionadas:</label>
                        <div id="selectedAppImagesList" style="display: flex; gap: 10px; flex-wrap;"></div>
                    </div>
                    <!-- [NOVO BLOCO] Sele√ß√£o de imagens do app no formul√°rio de v√≠deo -->
                    <div class="form-group" id="videoAppImageSelector">
                        <label>Imagens do App para este v√≠deo:</label>
                        <div style="margin-bottom:10px;">
                            <button type="button" class="music-category-btn active" onclick="filterAppImagesForVideo('all', this)">üì± Todas</button>
                            <button type="button" class="music-category-btn" onclick="filterAppImagesForVideo('app-mockup', this)">üì± Mockups</button>
                            <button type="button" class="music-category-btn" onclick="filterAppImagesForVideo('screenshot', this)">üì∏ Screenshots</button>
                            <button type="button" class="music-category-btn" onclick="filterAppImagesForVideo('interface', this)">üé® Interface</button>
                            <button type="button" class="music-category-btn" onclick="filterAppImagesForVideo('feature', this)">‚ö° Funcionalidades</button>
                            <button type="button" class="music-category-btn" onclick="filterAppImagesForVideo('marketing', this)">üìà Marketing</button>
                        </div>
                        <div id="videoAppImageGallery" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(90px,1fr));gap:10px;"></div>
                        <div style="font-size:0.85em;color:#888;margin-top:5px;">Selecione as imagens que deseja usar neste v√≠deo. (Clique para selecionar/deselecionar)</div>
                    </div>
                    <button type="submit" class="btn">
                        <i class="fas fa-magic"></i> Gerar V√≠deo Completo
                    </button>
                </form>
                
                <!-- Preview do Roteiro -->
                <div class="script-preview" id="scriptPreview" style="display: none;">
                    <h3>üìù Preview do Roteiro:</h3>
                    <div id="scriptContent" class="script-content"></div>
                    <button class="btn btn-secondary" onclick="editScript()">
                        <i class="fas fa-edit"></i> Editar Roteiro
                    </button>
                </div>
                <!-- Resultado do V√≠deo -->
                <div class="result" id="videoResult" style="display: none;">
                    <h3>üé¨ Seu V√≠deo Est√° Pronto!</h3>
                    <div class="video-preview">
                        <video id="videoPlayer" controls>
                            <source id="videoSource" src="" type="video/mp4">
                            Seu navegador n√£o suporta v√≠deos.
                        </video>
                    </div>
                    <div class="video-actions">
                        <button class="btn btn-primary" onclick="downloadVideo()">
                            <i class="fas fa-download"></i> Baixar V√≠deo
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Card de Configura√ß√µes (abaixo do gerador) -->
        <div class="dashboard" style="margin-top: 30px;">
            <div class="card">
                <h2><i class="fas fa-cog"></i> Configura√ß√µes</h2>
                <p style="margin-bottom: 20px; color: #666;">
                    Gerencie suas credenciais de API e configura√ß√µes do sistema.
                </p>
                <button type="button" class="btn" onclick="openCredModal()">
                    <i class="fas fa-key"></i> Gerenciar Credenciais
                </button>
            </div>
        </div>

        <!-- Galeria de V√≠deos -->
        <div class="dashboard" style="margin-top: 30px;">
            <div class="card">
                <h2><i class="fas fa-film"></i> Galeria de V√≠deos</h2>
                <p style="margin-bottom: 20px; color: #666;">
                    Visualize e gerencie todos os v√≠deos gerados.
                </p>
                <button type="button" class="btn" onclick="loadVideoGallery()">
                    <i class="fas fa-sync"></i> Atualizar Galeria
                </button>
                <div id="videoGallery" class="video-gallery">
                    <div class="gallery-loading" style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 2em; margin-bottom: 10px;"></i>
                        <p>Carregando galeria...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gerenciador de Imagens do App -->
        <div class="dashboard" style="margin-top: 30px;">
            <div class="card">
                <h2><i class="fas fa-mobile-alt"></i> Imagens do App</h2>
                <p style="margin-bottom: 20px; color: #666;">
                    Gerencie screenshots e mockups do app para usar nos v√≠deos.
                </p>
                
                <!-- Upload de Imagem -->
                <div style="margin-bottom: 20px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                    <h3 style="margin-bottom: 15px; color: #667eea;">üì± Adicionar Nova Imagem</h3>
                    <form id="appImageForm" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="appImageFile">Selecionar Imagem:</label>
                            <input type="file" id="appImageFile" name="image" accept="image/*" required>
                        </div>
                        <div class="form-group">
                            <label for="appImageTag">Tag/Categoria:</label>
                            <select id="appImageTag" name="tag">
                                <option value="app-mockup">Mockup do App</option>
                                <option value="screenshot">Screenshot</option>
                                <option value="interface">Interface</option>
                                <option value="feature">Funcionalidade</option>
                                <option value="marketing">Marketing</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="appImageDescription">Descri√ß√£o:</label>
                            <textarea id="appImageDescription" name="description" placeholder="Descreva a imagem..." rows="2"></textarea>
                        </div>
                        <button type="submit" class="btn">
                            <i class="fas fa-upload"></i> Enviar Imagem
                        </button>
                    </form>
                </div>

                <!-- Sugest√µes Inteligentes de Imagens -->
                <div style="margin-bottom: 20px; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; color: white;">
                    <h3 style="margin-bottom: 15px; color: white;">
                        <i class="fas fa-brain"></i> Sugest√µes Inteligentes de Imagens
                    </h3>
                    <p style="margin-bottom: 15px; opacity: 0.9;">
                        Use IA para gerar sugest√µes de imagens espec√≠ficas para cada cena do seu v√≠deo.
                    </p>
                    
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3);" onclick="generateImageSuggestions()">
                            <i class="fas fa-magic"></i> Gerar Sugest√µes por Cena
                        </button>
                        <button class="btn" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3);" onclick="generateImageThemes()">
                            <i class="fas fa-palette"></i> Sugerir Temas de Imagens
                        </button>
                    </div>
                    
                    <!-- Resultado das sugest√µes -->
                    <div id="suggestions-result" style="display: none; margin-top: 20px; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px;">
                        <h4 style="color: white; margin-bottom: 10px;">Sugest√µes Geradas</h4>
                        <div id="suggestions-content"></div>
                    </div>
                    
                    <!-- Temas sugeridos -->
                    <div id="themes-result" style="display: none; margin-top: 20px; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px;">
                        <h4 style="color: white; margin-bottom: 10px;">Temas de Imagens Sugeridos</h4>
                        <div id="themes-content"></div>
                    </div>
                </div>

                <!-- Filtros -->
                <div style="margin-bottom: 20px;">
                    <div class="music-categories">
                        <button class="music-category-btn active" onclick="filterAppImages('all')">üì± Todas</button>
                        <button class="music-category-btn" onclick="filterAppImages('app-mockup')">üì± Mockups</button>
                        <button class="music-category-btn" onclick="filterAppImages('screenshot')">üì∏ Screenshots</button>
                        <button class="music-category-btn" onclick="filterAppImages('interface')">üé® Interface</button>
                        <button class="music-category-btn" onclick="filterAppImages('feature')">‚ö° Funcionalidades</button>
                        <button class="music-category-btn" onclick="filterAppImages('marketing')">üìà Marketing</button>
                    </div>
                </div>

                <!-- Galeria de Imagens -->
                <div id="appImageGallery" class="app-image-gallery">
                    <div class="gallery-loading" style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 2em; margin-bottom: 10px;"></i>
                        <p>Carregando imagens...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Se√ß√£o de Status das APIs -->
        <div class="config-section">
          <h3>üîß Status das APIs</h3>
          <div class="api-status-container">
            <div class="api-status-grid">
              <div class="api-status-item" id="gemini-status">
                <div class="api-name">ü§ñ Gemini</div>
                <div class="api-indicator">‚è≥ Verificando...</div>
                <div class="api-usage" id="gemini-usage"></div>
              </div>
              <div class="api-status-item" id="groq-status">
                <div class="api-name">‚ö° Groq</div>
                <div class="api-indicator">‚è≥ Verificando...</div>
                <div class="api-usage" id="groq-usage"></div>
              </div>
              <div class="api-status-item" id="openai-status">
                <div class="api-name">üß† OpenAI</div>
                <div class="api-indicator">‚è≥ Verificando...</div>
                <div class="api-usage" id="openai-usage"></div>
              </div>
              <div class="api-status-item" id="elevenlabs-status">
                <div class="api-name">üé§ ElevenLabs</div>
                <div class="api-indicator">‚è≥ Verificando...</div>
                <div class="api-usage" id="elevenlabs-usage"></div>
              </div>
            </div>
            <div class="api-buttons">
              <button onclick="checkApiStatus()" class="btn btn-secondary">üîÑ Verificar Status</button>
              <button onclick="checkTokenUsage()" class="btn btn-secondary">üìä Verificar Uso</button>
            </div>
            <div class="api-summary" id="api-summary"></div>
          </div>
        </div>

        <!-- Se√ß√£o de Configura√ß√£o de API Keys -->
    </div>

    <!-- Modal de Credenciais -->
    <div id="credModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-key"></i> Configura√ß√µes de Credenciais</h2>
                <span class="close" onclick="closeCredModal()">&times;</span>
            </div>
            <form id="credForm" autocomplete="off">
                <div class="form-group">
                    <label for="credCLOUDINARY_CLOUD_NAME">Cloudinary Cloud Name</label>
                    <div class="cred-input-group">
                        <input type="text" id="credCLOUDINARY_CLOUD_NAME" name="CLOUDINARY_CLOUD_NAME" placeholder="cloud_name" required>
                        <button type="button" class="save-cred-btn" data-name="CLOUDINARY_CLOUD_NAME">Salvar</button>
                        <span class="cred-status" id="statusCLOUDINARY_CLOUD_NAME"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="credCLOUDINARY_API_KEY">Cloudinary API Key</label>
                    <div class="cred-input-group">
                        <input type="text" id="credCLOUDINARY_API_KEY" name="CLOUDINARY_API_KEY" placeholder="api_key" required>
                        <button type="button" class="save-cred-btn" data-name="CLOUDINARY_API_KEY">Salvar</button>
                        <span class="cred-status" id="statusCLOUDINARY_API_KEY"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="credCLOUDINARY_API_SECRET">Cloudinary API Secret</label>
                    <div class="cred-input-group">
                        <input type="password" id="credCLOUDINARY_API_SECRET" name="CLOUDINARY_API_SECRET" placeholder="api_secret" required>
                        <button type="button" class="save-cred-btn" data-name="CLOUDINARY_API_SECRET">Salvar</button>
                        <span class="cred-status" id="statusCLOUDINARY_API_SECRET"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="credGEMINI_KEY">Gemini API Key</label>
                    <div class="cred-input-group">
                        <input type="text" id="credGEMINI_KEY" name="GEMINI_KEY" placeholder="sk-..." required>
                        <button type="button" class="save-cred-btn" data-name="GEMINI_KEY">Salvar</button>
                        <span class="cred-status" id="statusGEMINI_KEY"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="credGROQ_API_KEY">Groq API Key</label>
                    <div class="cred-input-group">
                        <input type="text" id="credGROQ_API_KEY" name="GROQ_API_KEY" placeholder="gsk_...">
                        <button type="button" class="save-cred-btn" data-name="GROQ_API_KEY">Salvar</button>
                        <span class="cred-status" id="statusGROQ_API_KEY"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="credFREEPIK_API_KEY">Freepik API Key</label>
                    <div class="cred-input-group">
                        <input type="text" id="credFREEPIK_API_KEY" name="FREEPIK_API_KEY" placeholder="...">
                        <button type="button" class="save-cred-btn" data-name="FREEPIK_API_KEY">Salvar</button>
                        <span class="cred-status" id="statusFREEPIK_API_KEY"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="credELEVENLABS_API_KEY">ElevenLabs API Key</label>
                    <div class="cred-input-group">
                        <input type="text" id="credELEVENLABS_API_KEY" name="ELEVENLABS_API_KEY" placeholder="...">
                        <button type="button" class="save-cred-btn" data-name="ELEVENLABS_API_KEY">Salvar</button>
                        <button type="button" class="check-credits-btn" onclick="checkElevenLabsCredits()">
                            <i class="fas fa-credit-card"></i> Verificar Cr√©ditos
                        </button>
                        <span class="cred-status" id="statusELEVENLABS_API_KEY"></span>
                    </div>
                    <div id="elevenlabsCreditsInfo" class="credits-info" style="display: none; margin-top: 10px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #667eea;">
                        <div class="credits-header" style="font-weight: 600; margin-bottom: 10px; color: #667eea;">
                            <i class="fas fa-info-circle"></i>
                            <span>Informa√ß√µes dos Cr√©ditos ElevenLabs</span>
                        </div>
                        <div class="credits-details" style="font-size: 0.9rem;">
                            <div class="credit-item" style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span class="credit-label" style="font-weight: 500;">Email:</span>
                                <span id="elevenlabsEmail" class="credit-value">-</span>
                            </div>
                            <div class="credit-item" style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span class="credit-label" style="font-weight: 500;">Plano:</span>
                                <span id="elevenlabsPlan" class="credit-value">-</span>
                            </div>
                            <div class="credit-item" style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span class="credit-label" style="font-weight: 500;">Caracteres Usados:</span>
                                <span id="elevenlabsUsed" class="credit-value">-</span>
                            </div>
                            <div class="credit-item" style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span class="credit-label" style="font-weight: 500;">Limite:</span>
                                <span id="elevenlabsLimit" class="credit-value">-</span>
                            </div>
                            <div class="credit-item" style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span class="credit-label" style="font-weight: 500;">Restantes:</span>
                                <span id="elevenlabsRemaining" class="credit-value" style="color: #28a745; font-weight: 600;">-</span>
                            </div>
                            <div class="credit-item" style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span class="credit-label" style="font-weight: 500;">Percentual:</span>
                                <span id="elevenlabsPercentage" class="credit-value">-</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="credCOLAB_SD_URL">Colab Stable Diffusion URL</label>
                    <div class="cred-input-group">
                        <input type="text" id="credCOLAB_SD_URL" name="COLAB_SD_URL" placeholder="https://...">
                        <button type="button" class="save-cred-btn" data-name="COLAB_SD_URL">Salvar</button>
                        <span class="cred-status" id="statusCOLAB_SD_URL"></span>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal da Biblioteca de M√∫sicas -->
    <div id="musicModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-music"></i> Biblioteca de M√∫sicas</h2>
                <span class="close" onclick="closeMusicModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="music-categories">
                    <button class="music-category-btn active" onclick="filterMusic('all')">üéµ Todas</button>
                    <button class="music-category-btn" onclick="filterMusic('ambient')">üåø Ambiental</button>
                    <button class="music-category-btn" onclick="filterMusic('energetic')">‚ö° Energ√©tica</button>
                    <button class="music-category-btn" onclick="filterMusic('emotional')">üíù Emocional</button>
                    <button class="music-category-btn" onclick="filterMusic('corporate')">üíº Corporativa</button>
                </div>
                <div id="musicLibrary" class="music-library">
                    <div class="loading">Carregando m√∫sicas...</div>
                </div>
                <audio id="modalMusicPreview" style="display: none;"></audio>
            </div>
        </div>
    </div>

    <!-- Modal de Visualiza√ß√£o de V√≠deo -->
    <div id="videoModal" class="video-modal">
        <div class="video-modal-content">
            <div class="video-modal-header">
                <h3 id="videoModalTitle">Visualizar V√≠deo</h3>
                <button class="video-modal-close" onclick="closeVideoModal()">&times;</button>
            </div>
            <div class="video-modal-body">
                <div style="margin-bottom: 15px;">
                    <input id="customVideoUrl" type="text" placeholder="Cole aqui qualquer link de v√≠deo (.mp4, Cloudinary, Pippit, etc) e pressione Enter" style="width:100%;padding:8px 12px;border-radius:8px;border:1px solid #eee;font-size:0.95rem;">
                </div>
                <video id="videoModalPlayer" class="video-modal-video" controls>
                    <source id="videoModalSource" src="" type="video/mp4">
                    Seu navegador n√£o suporta v√≠deos.
                </video>
                <div class="video-modal-actions">
                    <button id="videoModalDownload" class="video-btn primary" onclick="downloadFromModal()">
                        <i class="fas fa-download"></i> Baixar V√≠deo
                    </button>
                    <button class="video-btn secondary" onclick="copyVideoLink()">
                        <i class="fas fa-link"></i> Copiar Link
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Edi√ß√£o de Metadados -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> Editar Metadados do V√≠deo</h2>
                <span class="close" onclick="closeEditModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="editVideoForm">
                    <input type="hidden" id="editVideoId">
                    <div class="form-group">
                        <label for="editVideoTitle">T√≠tulo do V√≠deo:</label>
                        <input type="text" id="editVideoTitle" placeholder="Digite o t√≠tulo do v√≠deo" maxlength="100" required>
                        <small style="color: #666;">M√°ximo 100 caracteres</small>
                    </div>
                    <div class="form-group">
                        <label for="editVideoHashtags">Hashtags:</label>
                        <textarea id="editVideoHashtags" placeholder="Digite as hashtags separadas por espa√ßo" rows="3" maxlength="500"></textarea>
                        <small style="color: #666;">Ex: #Maternidade #BabyDiary #DicasParaM√£es</small>
                    </div>
                    <div class="form-group">
                        <label>Legenda do Instagram:</label>
                        <div id="editVideoCaption" style="background: #f8f9fa; padding: 12px; border-radius: 6px; border-left: 3px solid #667eea; font-size: 0.9rem; line-height: 1.4; max-height: 120px; overflow-y: auto; color: #666;">
                            <em>Legenda ser√° exibida aqui...</em>
                        </div>
                        <small style="color: #666;">Legenda gerada automaticamente pela IA</small>
                    </div>
                    <div class="form-group">
                        <label>Informa√ß√µes do V√≠deo:</label>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; font-size: 0.9rem;">
                            <div style="margin-bottom: 8px;">
                                <strong>Tema:</strong> <span id="editVideoTema"></span>
                            </div>
                            <div style="margin-bottom: 8px;">
                                <strong>Tipo:</strong> <span id="editVideoTipo"></span>
                            </div>
                            <div style="margin-bottom: 8px;">
                                <strong>P√∫blico:</strong> <span id="editVideoPublico"></span>
                            </div>
                            <div style="margin-bottom: 8px;">
                                <strong>Formato:</strong> <span id="editVideoFormato"></span>
                            </div>
                            <div>
                                <strong>Criado em:</strong> <span id="editVideoCreatedAt"></span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" style="text-align: center; margin-top: 20px;">
                        <button type="submit" class="btn" style="width: auto; padding: 12px 30px;">
                            <i class="fas fa-save"></i> Salvar Altera√ß√µes
                        </button>
                        <button type="button" class="btn" onclick="closeEditModal()" style="width: auto; padding: 12px 30px; background: #6c757d; margin-left: 10px;">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loading" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(255,255,255,0.7);z-index:9999;align-items:center;justify-content:center;">
      <span style="font-size:2em;">‚è≥ Carregando...</span>
    </div>

    <script>
        // Configura√ß√£o da API
        const API_BASE_URL = '/api';

        // Fun√ß√µes utilit√°rias
        function showLoading(formId) {
            const loadingElement = document.getElementById('loading');
            if (loadingElement) {
                loadingElement.style.display = 'flex';
            }
            const resultElement = document.getElementById(formId + 'Result');
            if (resultElement) {
                resultElement.style.display = 'none';
            }
        }

        function hideLoading(formId) {
            const loadingElement = document.getElementById('loading');
            if (loadingElement) {
                loadingElement.style.display = 'none';
            }
        }

        function showResult(formId, content) {
            document.getElementById(formId + 'Content').textContent = content;
            document.getElementById(formId + 'Result').style.display = 'block';
        }

        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('Texto copiado para a √°rea de transfer√™ncia!');
            });
        }

        function shareToSocial(platform) {
            const text = document.getElementById('captionContent').textContent;
            let url = '';
            
            switch(platform) {
                case 'instagram':
                    alert('Copie a legenda e cole no Instagram!');
                    break;
                case 'facebook':
                    url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}&quote=${encodeURIComponent(text)}`;
                    window.open(url, '_blank');
                    break;
                case 'tiktok':
                    alert('Copie a descri√ß√£o e cole no TikTok!');
                    break;
            }
        }

        function downloadVideo() {
            const videoSource = document.getElementById('videoSource');
            if (videoSource && videoSource.src) {
                const a = document.createElement('a');
                a.href = videoSource.src;
                a.download = 'baby-diary-video.mp4';
                a.click();
            } else {
                showNotification('Nenhum v√≠deo dispon√≠vel para download', 'error');
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 600;
                z-index: 10000;
                animation: slideIn 0.3s ease-out;
                max-width: 300px;
            `;
            
            const colors = {
                success: '#28a745',
                error: '#dc3545',
                warning: '#ffc107',
                info: '#17a2b8'
            };
            
            notification.style.backgroundColor = colors[type] || colors.info;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Adicionar estilos CSS para as anima√ß√µes
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Event Listeners
        document.getElementById('videoForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            showLoading('video');
            
            try {
                // Pegar valores dos campos do formul√°rio
                const tema = document.getElementById('videoTema').value;
                const tipo = document.getElementById('videoTipo').value;
                const duracaoTotal = document.getElementById('videoDuracaoTotal').value;
                const publico = document.getElementById('videoPublico').value;
                const formato = document.getElementById('videoFormato').value;
                const cenas = document.getElementById('videoCenas').value;
                const resolution = document.getElementById('videoAspecto').value;
                const estilo = document.getElementById('videoEstilo').value;
                
                // Preparar dados da m√∫sica de fundo
                const backgroundMusic = getBackgroundMusicData();
                
                const response = await fetch(`${API_BASE_URL}/generate-video`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        tema, 
                        tipo, 
                        duracaoTotal, 
                        publico, 
                        formato, 
                        cenas, 
                        resolution, 
                        estilo,
                        backgroundMusic,
                        appImageIds: selectedAppImages // <-- Enviar IDs das imagens selecionadas
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    const videoUrl = data.cloudinaryUrl || data.downloadUrl || data.url || data.videoUrl;
                    
                    // Atualizar o source do v√≠deo existente
                    const videoSource = document.getElementById('videoSource');
                    const videoPlayer = document.getElementById('videoPlayer');
                    if (videoSource && videoPlayer) {
                        videoSource.src = videoUrl;
                        videoPlayer.load(); // Recarregar o v√≠deo com a nova URL
                    }
                    
                    // Mostrar informa√ß√µes adicionais se dispon√≠veis
                    let resultHTML = `
                        <h3>üé¨ Seu V√≠deo Est√° Pronto!</h3>
                        <div class="video-preview">
                            <video id="videoPlayer" controls>
                                <source id="videoSource" src="${videoUrl}" type="video/mp4">
                                Seu navegador n√£o suporta v√≠deos.
                            </video>
                        </div>
                    `;
                    
                    // Adicionar informa√ß√µes de metadados se dispon√≠veis
                    if (data.titulo || data.hashtags) {
                        resultHTML += `
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
                                <h4 style="color: #667eea; margin-bottom: 10px;">üìù Informa√ß√µes Geradas:</h4>
                                ${data.titulo ? `<p><strong>T√≠tulo:</strong> ${data.titulo}</p>` : ''}
                                ${data.hashtags ? `<p><strong>Hashtags:</strong> <span style="color: #667eea;">${data.hashtags}</span></p>` : ''}
                                ${data.videoId ? `<p><strong>ID do V√≠deo:</strong> ${data.videoId}</p>` : ''}
                                ${data.cloudinaryThumbnailUrl ? `<p><strong>Thumbnail:</strong> <a href="${data.cloudinaryThumbnailUrl}" target="_blank" style="color: #667eea;">Ver no Cloudinary</a></p>` : ''}
                            </div>
                        `;
                    }
                    
                    resultHTML += `
                        <div class="video-actions">
                            <button class="btn btn-primary" onclick="downloadVideo()">
                                <i class="fas fa-download"></i> Baixar V√≠deo
                            </button>
                        </div>
                    `;
                    
                    document.getElementById('videoResult').innerHTML = resultHTML;
                    document.getElementById('videoResult').style.display = 'block';
                    
                    showNotification('V√≠deo gerado com sucesso!', 'success');
                    
                    // Atualizar galeria automaticamente
                    setTimeout(() => {
                        loadVideoGallery(1); // Voltar para primeira p√°gina
                    }, 2000);
                } else {
                    showNotification(data.error || 'Erro ao gerar v√≠deo', 'error');
                }
            } catch (error) {
                showResult('video', 'Erro ao gerar v√≠deo. Tente novamente.');
            } finally {
                hideLoading('video');
            }
        });

        // Simula√ß√£o de API para demonstra√ß√£o
        if (!window.location.hostname.includes('localhost')) {
            // Fallback para demonstra√ß√£o sem backend
            document.getElementById('videoForm').addEventListener('submit', (e) => {
                e.preventDefault();
                showLoading('video');
                setTimeout(() => {
                    const tipos = {
                        anuncio: "An√∫ncio/Publicidade (30-60s): 'Descubra a Baby Diary - Conhe√ßa nossas dicas de amamenta√ß√£o, cuidados e alimenta√ß√£o. #BabyDiary #AmorDeMae #Maternidade'",
                        dica: "Dica R√°pida (15-30s): 'Dica r√°pida que vai mudar sua vida! üë∂‚ú® #BabyHack #Maternidade #TikTokBrasil #DicaDoDia'",
                        educativo: "Educativo (60-90s): 'A jornada da maternidade √© cheia de aprendizados. Cada dia traz novos desafios e conquistas. Como voc√™s lidam com os momentos dif√≠ceis? Compartilhem suas experi√™ncias nos coment√°rios! #BabyDiary #Maternidade #AmorDeMae'",
                        story: "Story/Reels (15-30s): 'Cada momento com o beb√™ √© um tesouro precioso. Aproveite cada sorriso, cada descoberta. O tempo passa r√°pido demais! üë∂üíï #BabyDiary #Maternidade #AmorDeMae #DesenvolvimentoInfantil #Crescimento'",
                        tutorial: "Tutorial (45-90s): 'Dica r√°pida que vai mudar sua vida! üë∂‚ú® #BabyHack #Maternidade #TikTokBrasil #DicaDoDia'",
                        inspiracional: "Inspiracional (30-60s): 'A jornada da maternidade √© cheia de aprendizados. Cada dia traz novos desafios e conquistas. Como voc√™s lidam com os momentos dif√≠ceis? Compartilhem suas experi√™ncias nos coment√°rios! #BabyDiary #Maternidade #AmorDeMae'"
                    };
                    const tipo = document.getElementById('videoTipo').value;
                    showResult('video', tipos[tipo]);
                    hideLoading('video');
                }, 2000);
            });
        }

        // Atualizar valor do slider de cenas em tempo real
        const videoCenas = document.getElementById('videoCenas');
        const cenasValue = document.getElementById('cenasValue');
        if (videoCenas && cenasValue) {
          videoCenas.addEventListener('input', function() {
            cenasValue.textContent = `${this.value} cenas`;
          });
        }

        // --- M√öSICA DE FUNDO FUNCTIONS ---
        let selectedMusicFile = null;

        // Event listener para sele√ß√£o de arquivo de m√∫sica
        document.getElementById('backgroundMusic').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                selectedMusicFile = file;
                document.getElementById('selectedMusicName').textContent = file.name;
                document.getElementById('musicSettings').style.display = 'block';
                
                // Upload do arquivo para o servidor
                uploadMusicFile(file);
            }
        });

        // Event listeners para controles de m√∫sica
        document.getElementById('musicVolume').addEventListener('input', function() {
            const value = (this.value * 100).toFixed(0);
            document.getElementById('volumeValue').textContent = `${value}%`;
        });

        document.getElementById('musicFadeIn').addEventListener('input', function() {
            document.getElementById('fadeInValue').textContent = `${this.value}s`;
        });

        document.getElementById('musicFadeOut').addEventListener('input', function() {
            document.getElementById('fadeOutValue').textContent = `${this.value}s`;
        });

        // Fun√ß√£o para fazer upload do arquivo de m√∫sica
        async function uploadMusicFile(file) {
            try {
                const formData = new FormData();
                formData.append('music', file);
                
                const response = await fetch(`${API_BASE_URL}/upload-music`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                if (data.success) {
                    showNotification('M√∫sica carregada com sucesso!', 'success');
                } else {
                    showNotification('Erro ao carregar m√∫sica: ' + data.error, 'error');
                }
            } catch (error) {
                showNotification('Erro ao carregar m√∫sica', 'error');
            }
        }

        // Fun√ß√£o para obter dados da m√∫sica de fundo
        function getBackgroundMusicData() {
            if (!selectedMusicFile) return null;
            
            return {
                path: `assets/music/${selectedMusicFile.name}`, // Caminho completo para o arquivo
                volume: parseFloat(document.getElementById('musicVolume').value),
                loop: document.getElementById('musicLoop').checked,
                fadeIn: parseFloat(document.getElementById('musicFadeIn').value),
                fadeOut: parseFloat(document.getElementById('musicFadeOut').value)
            };
        }



        // --- BIBLIOTECA DE M√öSICAS FUNCTIONS ---
        let musicLibraryData = [];
        let currentMusicFilter = 'all';

        // Fun√ß√£o para mostrar modal da biblioteca de m√∫sicas
        function showMusicLibrary() {
            document.getElementById('musicModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
            loadMusicLibrary();
        }

        // Fun√ß√£o para fechar modal da biblioteca de m√∫sicas
        function closeMusicModal() {
            document.getElementById('musicModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Fun√ß√£o para carregar biblioteca de m√∫sicas
        async function loadMusicLibrary() {
            try {
                const response = await fetch(`${API_BASE_URL}/music-list`);
                const data = await response.json();
                
                if (data.success) {
                    musicLibraryData = data.music;
                    renderMusicLibrary();
                } else {
                    document.getElementById('musicLibrary').innerHTML = '<div class="error">Erro ao carregar m√∫sicas</div>';
                }
            } catch (error) {
                document.getElementById('musicLibrary').innerHTML = '<div class="error">Erro de conex√£o</div>';
            }
        }

        // Fun√ß√£o para renderizar biblioteca de m√∫sicas
        function renderMusicLibrary() {
            const library = document.getElementById('musicLibrary');
            const filteredMusic = filterMusicByCategory(musicLibraryData, currentMusicFilter);
            
            if (filteredMusic.length === 0) {
                library.innerHTML = '<div class="no-music">Nenhuma m√∫sica encontrada</div>';
                return;
            }
            
            library.innerHTML = filteredMusic.map(music => `
                <div class="music-item">
                    <div class="music-item-icon">üéµ</div>
                    <div class="music-item-info">
                        <div class="music-item-name">${music.name}</div>
                        <div class="music-item-category">${getMusicCategory(music.path)}</div>
                    </div>
                    <div class="music-item-actions">
                        <button class="btn btn-small" onclick="playMusicInModal('${music.path}', this)">
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="btn btn-small btn-primary" onclick="selectMusicFromLibrary('${music.path}', '${music.name}')">
                            <i class="fas fa-check"></i> Escolher
                        </button>
                    </div>
                    <div class="music-item-size">${formatFileSize(music.size)}</div>
                </div>
            `).join('');
        }

        // Fun√ß√£o para filtrar m√∫sicas por categoria
        function filterMusic(category) {
            currentMusicFilter = category;
            
            // Atualizar bot√µes ativos
            document.querySelectorAll('.music-category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderMusicLibrary();
        }

        // Fun√ß√£o para filtrar dados de m√∫sica por categoria
        function filterMusicByCategory(musicData, category) {
            if (category === 'all') return musicData;
            return musicData.filter(music => music.path.includes(`/${category}/`));
        }

        // Fun√ß√£o para obter categoria da m√∫sica
        function getMusicCategory(path) {
            if (path.includes('/ambient/')) return 'üåø Ambiental';
            if (path.includes('/energetic/')) return '‚ö° Energ√©tica';
            if (path.includes('/emotional/')) return 'üíù Emocional';
            if (path.includes('/corporate/')) return 'üíº Corporativa';
            return 'üéµ Geral';
        }

        // Fun√ß√£o para reproduzir m√∫sica no modal
        function playMusicInModal(musicPath, button) {
            const audio = document.getElementById('modalMusicPreview');
            const icon = button.querySelector('i');
            
            // Se j√° est√° tocando esta m√∫sica, pausar
            if (audio.src.includes(musicPath) && !audio.paused) {
                audio.pause();
                icon.className = 'fas fa-play';
                button.style.background = '';
                return;
            }
            
            // Parar qualquer m√∫sica que esteja tocando
            audio.pause();
            
            // Resetar todos os bot√µes
            document.querySelectorAll('.music-item-actions .btn').forEach(btn => {
                const btnIcon = btn.querySelector('i');
                if (btnIcon && btnIcon.className.includes('fa-pause')) {
                    btnIcon.className = 'fas fa-play';
                    btn.style.background = '';
                }
            });
            
            // Tocar a nova m√∫sica
            audio.src = `/${musicPath}`;
            audio.volume = 0.5;
            
            audio.play().then(() => {
                icon.className = 'fas fa-pause';
                button.style.background = '#e74c3c';
            }).catch(error => {
                console.error('Erro ao reproduzir m√∫sica:', error);
                showNotification('Erro ao reproduzir m√∫sica', 'error');
            });
        }

        // Fun√ß√£o para selecionar m√∫sica da biblioteca
        function selectMusicFromLibrary(musicPath, musicName) {
            selectedMusicFile = { name: musicName };
            document.getElementById('selectedMusicName').textContent = musicName;
            document.getElementById('musicSettings').style.display = 'block';
            closeMusicModal();
            showNotification('M√∫sica selecionada: ' + musicName, 'success');
        }

        // Fun√ß√£o para formatar tamanho do arquivo
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // --- MODAL FUNCTIONS ---
        function openCredModal() {
            document.getElementById('credModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeCredModal() {
            document.getElementById('credModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Fechar modal ao clicar fora dele
        window.onclick = function(event) {
            const credModal = document.getElementById('credModal');
            const musicModal = document.getElementById('musicModal');
            
            if (event.target === credModal) {
                closeCredModal();
            }
            if (event.target === musicModal) {
                closeMusicModal();
            }
        }

        // Fechar modal com ESC
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeCredModal();
                // closeChatModal(); // Removido, pois o chat est√° integrado
            }
        });

        // --- CHAT IA FUNCTIONS ---
        // Fun√ß√µes para o chat IA integrado no formul√°rio
        function sendQuickMessage(message) {
            document.getElementById('chatInput').value = message;
            sendChatMessage();
        }

        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const sendBtn = document.getElementById('sendChatBtn');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Adicionar mensagem do usu√°rio
            addMessageToChat('user', message);
            input.value = '';
            sendBtn.disabled = true;
            
            // Mostrar indicador de digita√ß√£o
            showTypingIndicator();
            
            try {
                const response = await fetch(`${API_BASE_URL}/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message })
                });
                
                const data = await response.json();
                hideTypingIndicator();
                
                if (data.success) {
                    addMessageToChat('bot', data.response);
                    
                    // Se houver sugest√µes de temas, adicionar bot√µes para aplicar
                    if (data.themes && data.themes.length > 0) {
                        addThemeSuggestions(data.themes);
                    }
                } else {
                    addMessageToChat('bot', 'Desculpe, ocorreu um erro. Tente novamente.');
                }
            } catch (error) {
                hideTypingIndicator();
                addMessageToChat('bot', 'Erro de conex√£o. Verifique se o servidor est√° rodando.');
            }
            
            sendBtn.disabled = false;
            input.focus();
        }

        function addMessageToChat(sender, content) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            const avatar = sender === 'bot' ? '<i class="fas fa-robot"></i>' : '<i class="fas fa-user"></i>';
            
            messageDiv.innerHTML = `
                <div class="message-avatar">
                    ${avatar}
                </div>
                <div class="message-content">
                    ${formatMessageContent(content)}
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function formatMessageContent(content) {
            // Converter quebras de linha em <br>
            content = content.replace(/\n/g, '<br>');
            
            // Detectar e formatar listas
            if (content.includes('‚Ä¢') || content.includes('-')) {
                content = content.replace(/([‚Ä¢-]\s*)(.+?)(?=\n|$)/g, '<li>$2</li>');
                content = content.replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');
            }
            
            // Detectar t√≠tulos (linhas que terminam com :)
            content = content.replace(/^(.+?):\s*$/gm, '<strong>$1:</strong>');
            
            return content;
        }

        function showTypingIndicator() {
            const chatMessages = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot-message';
            typingDiv.id = 'typingIndicator';
            
            typingDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="message-content">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        function addThemeSuggestions(themes) {
            const chatMessages = document.getElementById('chatMessages');
            const suggestionsDiv = document.createElement('div');
            suggestionsDiv.className = 'message bot-message';
            
            let suggestionsHTML = `
                <div class="message-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="message-content">
                    <p><strong>üí° Sugest√µes de Temas:</strong></p>
                    <div class="suggestion-cards">
            `;
            
            themes.forEach((theme, index) => {
                suggestionsHTML += `
                    <div class="suggestion-card" onclick="applyThemeSuggestion('${theme}')">
                        <h4>${theme}</h4>
                        <p>Clique para aplicar este tema</p>
                        <small style="color: #667eea;">Aplicar tema</small>
                    </div>
                `;
            });
            
            suggestionsHTML += `
                    </div>
                </div>
            `;
            
            suggestionsDiv.innerHTML = suggestionsHTML;
            chatMessages.appendChild(suggestionsDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function applyThemeSuggestion(theme) {
            // Aplicar apenas o tema no formul√°rio principal
            document.getElementById('videoTema').value = theme;
            
            // Fechar o chat e mostrar notifica√ß√£o
            // closeChatModal(); // Removido, pois o chat est√° integrado
            showNotification(`Tema aplicado: "${theme}"`, 'success');
            
            // Scroll para o formul√°rio
            document.querySelector('.card').scrollIntoView({ behavior: 'smooth' });
        }

        // Event listener para enviar mensagem com Enter
        document.addEventListener('DOMContentLoaded', function() {
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendChatMessage();
                    }
                });
            }
        });

        // --- CREDENCIAIS (refatorado individual) ---
        const credFields = [
            'CLOUDINARY_CLOUD_NAME',
            'CLOUDINARY_API_KEY',
            'CLOUDINARY_API_SECRET',
            'GEMINI_KEY',
            'GROQ_API_KEY',
            'FREEPIK_API_KEY',
            'ELEVENLABS_API_KEY',
            'COLAB_SD_URL'
        ];

        async function loadCredenciais() {
            try {
                const res = await fetch(`${API_BASE_URL}/config`);
                const data = await res.json();
                if (data.success && data.credentials) {
                    data.credentials.forEach(cred => {
                        const input = document.getElementById('cred' + cred.name);
                        if (input) input.value = cred.value;
                    });
                }
            } catch (e) {
                credFields.forEach(name => {
                    const status = document.getElementById('status' + name);
                    if (status) status.innerHTML = '<span style="color:red;">Erro ao carregar</span>';
                });
            }
        }

        async function saveCredential(name) {
            const input = document.getElementById('cred' + name);
            const status = document.getElementById('status' + name);
            if (!input || !status) return;
            if (input.value.trim() === '' && input.required) {
                status.innerHTML = '<span style="color:red;">Obrigat√≥rio</span>';
                input.style.borderColor = 'red';
                return;
            }
            input.style.borderColor = '';
            status.innerHTML = 'Salvando...';
            try {
                const res = await fetch(`${API_BASE_URL}/config`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, value: input.value })
                });
                const data = await res.json();
                if (data.success) {
                    status.innerHTML = '<span style="color:green;">Salvo!</span>';
                } else {
                    status.innerHTML = `<span style='color:red;'>${data.error || 'Erro'}</span>`;
                }
            } catch (e) {
                status.innerHTML = `<span style='color:red;'>Erro ao salvar</span>`;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Baby Diary AI - Interface carregada');
            
            // For√ßar recarregamento do cache para evitar problemas
            forceCacheReload();
            
            loadCredenciais();
            loadVideoGallery(); // Carregar galeria automaticamente
            document.querySelectorAll('.save-cred-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const name = btn.getAttribute('data-name');
                    saveCredential(name);
                });
            });
            
            // Event listener para formul√°rio de edi√ß√£o de metadados
            const editVideoForm = document.getElementById('editVideoForm');
            if (editVideoForm) {
                editVideoForm.addEventListener('submit', saveVideoMetadata);
            }
            
            // Fechar modais ao clicar fora
            window.addEventListener('click', function(event) {
                const editModal = document.getElementById('editModal');
                if (event.target === editModal) {
                    closeEditModal();
                }
            });
            
            // Fechar modais com ESC
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    closeEditModal();
                }
            });
        });

        // --- FUN√á√ïES DA GALERIA ---
        let allVideos = [];
        let currentVideoPage = 1;
        const videosPerPage = 6;

        // Fun√ß√£o para verificar status do TikTok para m√∫ltiplos v√≠deos
        async function checkTikTokStatusForVideos(videos) {
            for (const video of videos) {
                try {
                    const response = await fetch(`${API_BASE_URL}/tiktok/status/${video.id}`);
                    const data = await response.json();
                    
                    if (data.success && data.tiktokPosted) {
                        const tiktokBtn = document.getElementById(`tiktok-btn-${video.id}`);
                        if (tiktokBtn) {
                            tiktokBtn.innerHTML = '<i class="fas fa-check"></i> Postado';
                            tiktokBtn.classList.add('posted');
                            tiktokBtn.onclick = () => {
                                if (data.tiktokUrl) {
                                    window.open(data.tiktokUrl, '_blank');
                                }
                            };
                        }
                    }
                } catch (error) {
                    console.error(`Erro ao verificar status do TikTok para v√≠deo ${video.id}:`, error);
                }
            }
        }

        async function loadVideoGallery(page = 1) {
            const gallery = document.getElementById('videoGallery');
            gallery.innerHTML = `
                <div class="gallery-loading" style="text-align: center; padding: 40px; color: #666;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2em; margin-bottom: 10px;"></i>
                    <p>Carregando galeria...</p>
                </div>
            `;

            try {
                const response = await fetch(`${API_BASE_URL}/videos`);
                const data = await response.json();
                
                // Debug: mostrar dados dos v√≠deos no console
                console.log('üìä Dados dos v√≠deos recebidos:', data);
                if (data.videos && data.videos.length > 0) {
                    data.videos.forEach((video, index) => {
                        console.log(`üé¨ V√≠deo ${index + 1}:`, {
                            id: video.id,
                            titulo: video.titulo,
                            videoPath: video.videoPath,
                            thumbnailPath: video.thumbnailPath,
                            tamanho: video.tamanho
                        });
                    });
                }
                
                if (data.videos && data.videos.length > 0) {
                    // Ordenar v√≠deos por data de cria√ß√£o (mais recentes primeiro)
                    allVideos = data.videos.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    
                    // Calcular v√≠deos para mostrar na p√°gina atual
                    const startIndex = (page - 1) * videosPerPage;
                    const endIndex = startIndex + videosPerPage;
                    const videosToShow = allVideos.slice(startIndex, endIndex);
                    
                    const galleryHTML = `
                        <div style="margin-bottom: 15px; color: #666; font-size: 0.9rem;">
                            <i class="fas fa-film"></i> ${data.total} v√≠deo${data.total > 1 ? 's' : ''} encontrado${data.total > 1 ? 's' : ''}
                            ${allVideos.length > videosPerPage ? ` (mostrando ${startIndex + 1}-${Math.min(endIndex, allVideos.length)} de ${allVideos.length})` : ''}
                        </div>
                        <div class="gallery-grid">
                            ${videosToShow.map(video => createVideoCard(video)).join('')}
                        </div>
                        ${allVideos.length > videosPerPage ? `
                            <div style="text-align: center; margin-top: 20px;">
                                ${page > 1 ? `<button class="btn btn-secondary" onclick="loadVideoGallery(${page - 1})" style="margin-right: 10px;">
                                    <i class="fas fa-chevron-left"></i> Anterior
                                </button>` : ''}
                                ${endIndex < allVideos.length ? `<button class="btn btn-primary" onclick="loadVideoGallery(${page + 1})">
                                    Ver Mais <i class="fas fa-chevron-right"></i>
                                </button>` : ''}
                            </div>
                        ` : ''}
                    `;
                    // Usar inser√ß√£o segura de HTML
                    safeInsertHTML(gallery, galleryHTML);
                    currentVideoPage = page;
                    
                    // Verificar status do TikTok para todos os v√≠deos
                    await checkTikTokStatusForVideos(videosToShow);
                } else {
                    gallery.innerHTML = `
                        <div class="empty-gallery">
                            <i class="fas fa-film"></i>
                            <h3>Nenhum v√≠deo encontrado</h3>
                            <p>Gere seu primeiro v√≠deo para ver aqui!</p>
                        </div>
                    `;
                }
            } catch (error) {
                gallery.innerHTML = `
                    <div class="empty-gallery">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Erro ao carregar galeria</h3>
                        <p>Verifique se o servidor est√° rodando.</p>
                    </div>
                `;
            }
        }

        // Fun√ß√£o para escapar strings JavaScript
        function escapeJS(str) {
            if (!str) return '';
            
            // Primeiro sanitizar a string
            let sanitized = sanitizeHTML(str);
            
            // Aplicar escape espec√≠fico para JavaScript
            return sanitized
                .replace(/\\/g, '\\\\')      // Escapar barras invertidas primeiro
                .replace(/'/g, "\\'")        // Escapar aspas simples
                .replace(/"/g, '\\"')        // Escapar aspas duplas
                .replace(/\n/g, ' ')         // Substituir quebras de linha por espa√ßo
                .replace(/\r/g, ' ')         // Substituir retornos por espa√ßo
                .replace(/\t/g, ' ')         // Substituir tabs por espa√ßo
                .replace(/\f/g, ' ')         // Substituir form feeds por espa√ßo
                .replace(/\v/g, ' ')         // Substituir vertical tabs por espa√ßo
                .replace(/\0/g, '')          // Remover null bytes
                .replace(/[\u0000-\u001F\u007F-\u009F]/g, ' ') // Remover caracteres de controle
                .replace(/[\u200B-\u200D\uFEFF]/g, '') // Remover zero-width spaces
                .replace(/[\u2060-\u2064\u206A-\u206F]/g, '') // Remover outros caracteres invis√≠veis
                .replace(/\s+/g, ' ')        // Normalizar espa√ßos m√∫ltiplos
                .trim();                     // Remover espa√ßos extras
        }

        // Fun√ß√£o para escapar URLs JavaScript
        function escapeURL(str) {
            if (!str) return '';
            return String(str)
                .replace(/\\/g, '\\\\')      // Escapar barras invertidas
                .replace(/'/g, "\\'")        // Escapar aspas simples
                .replace(/"/g, '\\"')        // Escapar aspas duplas
                .replace(/\n/g, '')          // Remover quebras de linha
                .replace(/\r/g, '')          // Remover retornos
                .replace(/\t/g, '')          // Remover tabs
                .replace(/\f/g, '')          // Remover form feeds
                .replace(/\v/g, '')          // Remover vertical tabs
                .replace(/\0/g, '')          // Remover null bytes
                .replace(/[\u0000-\u001F\u007F-\u009F]/g, '') // Remover caracteres de controle
                .trim();                     // Remover espa√ßos extras
        }

        // Fun√ß√£o para for√ßar recarregamento do cache
        function forceCacheReload() {
            // Adicionar timestamp √∫nico para for√ßar recarregamento
            const timestamp = Date.now();
            const links = document.querySelectorAll('link[rel="stylesheet"]');
            links.forEach(link => {
                if (link.href.includes('style.css')) {
                    link.href = link.href.split('?')[0] + '?v=' + timestamp;
                }
            });
            
            // For√ßar recarregamento do JavaScript
            const scripts = document.querySelectorAll('script[src]');
            scripts.forEach(script => {
                if (script.src.includes('script.js')) {
                    script.src = script.src.split('?')[0] + '?v=' + timestamp;
                }
            });
            
            // Limpar cache do localStorage se necess√°rio
            if (localStorage.getItem('forceReload') !== timestamp.toString()) {
                localStorage.setItem('forceReload', timestamp.toString());
                console.log('üîÑ Cache limpo, for√ßando recarregamento...');
            }
        }

        // Fun√ß√£o para limpar cache e recarregar p√°gina
        function clearCacheAndReload() {
            console.log('üßπ Limpando cache e recarregando...');
            
            // Limpar localStorage
            localStorage.clear();
            
            // Limpar sessionStorage
            sessionStorage.clear();
            
            // For√ßar recarregamento sem cache
            window.location.reload(true);
        }

        // Fun√ß√£o para for√ßar recarregamento com cache limpo
        function forceHardReload() {
            console.log('üîÑ For√ßando recarregamento completo...');
            
            // Limpar todos os caches
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                    });
                });
            }
            
            // Limpar storage
            localStorage.clear();
            sessionStorage.clear();
            
            // For√ßar recarregamento sem cache
            window.location.href = window.location.href + '?v=' + Date.now();
        }

        // Fun√ß√£o para limpeza completa e recarregamento
        function nuclearReload() {
            console.log('‚ò¢Ô∏è LIMPEZA NUCLEAR - Recarregando tudo...');
            
            // Limpar tudo
            localStorage.clear();
            sessionStorage.clear();
            
            // Limpar caches
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => caches.delete(name));
                });
            }
            
            // Limpar service workers
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(registrations => {
                    registrations.forEach(registration => registration.unregister());
                });
            }
            
            // For√ßar recarregamento com timestamp √∫nico
            const timestamp = Date.now();
            const url = new URL(window.location.href);
            url.searchParams.set('v', timestamp);
            url.searchParams.set('clean', 'true');
            
            window.location.href = url.toString();
        }

        // Fun√ß√£o para sanitizar HTML completamente
        function sanitizeHTML(str) {
            if (!str) return '';
            
            // Converter para string e remover caracteres problem√°ticos
            let sanitized = String(str)
                .replace(/[\u0000-\u001F\u007F-\u009F]/g, '') // Remover caracteres de controle
                .replace(/[\u2028\u2029]/g, '') // Remover separadores de linha Unicode
                .replace(/\0/g, '') // Remover null bytes
                .replace(/[\uFFFD]/g, '') // Remover replacement characters
                .replace(/[\u200B-\u200D\uFEFF]/g, '') // Remover zero-width spaces
                .replace(/[\u2060-\u2064\u206A-\u206F]/g, '') // Remover outros caracteres invis√≠veis
                .replace(/[\u0080-\u009F]/g, '') // Remover caracteres de controle estendidos
                .replace(/[\u00A0-\u00FF]/g, function(match) {
                    // Manter apenas caracteres latinos b√°sicos
                    return /[a-zA-Z0-9\s\-_.,!?()]/g.test(match) ? match : '';
                })
                .trim();
            
            // Se ficou vazio ap√≥s sanitiza√ß√£o, retornar string padr√£o
            return sanitized || 'V√≠deo';
        }

        // Fun√ß√£o para sanitiza√ß√£o ultra-agressiva
        function ultraSanitize(str) {
            if (!str) return '';
            
            // Converter para string e manter apenas caracteres ASCII seguros
            let sanitized = String(str)
                .split('')
                .map(char => {
                    const code = char.charCodeAt(0);
                    // Manter apenas caracteres ASCII seguros (32-126)
                    if (code >= 32 && code <= 126) {
                        return char;
                    }
                    // Substituir caracteres problem√°ticos por espa√ßos
                    return ' ';
                })
                .join('')
                .replace(/\s+/g, ' ') // Normalizar espa√ßos
                .trim();
            
            return sanitized || 'Video';
        }

        // Fun√ß√£o para detectar caracteres problem√°ticos
        function detectProblematicChars(str) {
            if (!str) return [];
            
            const problematic = [];
            for (let i = 0; i < str.length; i++) {
                const char = str[i];
                const code = str.charCodeAt(i);
                
                // Verificar caracteres que podem causar problemas
                if (code < 32 || code > 126) {
                    problematic.push({
                        char: char,
                        code: code,
                        position: i
                    });
                }
            }
            
            return problematic;
        }

        // Fun√ß√£o para validar e corrigir HTML antes de inserir no DOM
        function validateAndInsertHTML(container, html) {
            try {
                // Sanitizar o HTML antes de processar
                let sanitizedHTML = html;
                
                // Remover caracteres problem√°ticos do HTML
                sanitizedHTML = sanitizedHTML.replace(/[\u0000-\u001F\u007F-\u009F]/g, '');
                sanitizedHTML = sanitizedHTML.replace(/[\u2028\u2029]/g, '');
                sanitizedHTML = sanitizedHTML.replace(/[\u200B-\u200D\uFEFF]/g, '');
                
                // Criar um elemento tempor√°rio para validar o HTML
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = sanitizedHTML;
                
                // Verificar se h√° erros de sintaxe
                const scripts = tempDiv.querySelectorAll('script');
                scripts.forEach(script => {
                    try {
                        // Tentar avaliar o script para verificar sintaxe
                        new Function(script.textContent);
                    } catch (e) {
                        console.error('‚ùå Erro de sintaxe JavaScript detectado:', e);
                        // Remover o script problem√°tico
                        script.remove();
                    }
                });
                
                // Inserir o HTML validado
                container.innerHTML = tempDiv.innerHTML;
                
            } catch (error) {
                console.error('‚ùå Erro ao validar HTML:', error);
                // Fallback: inserir HTML simples
                container.innerHTML = '<div class="error">Erro ao carregar conte√∫do</div>';
            }
        }

        // Fun√ß√£o para inserir HTML de forma segura
        function safeInsertHTML(container, html) {
            try {
                // Usar DOMPurify se dispon√≠vel, sen√£o usar sanitiza√ß√£o manual
                if (typeof DOMPurify !== 'undefined') {
                    container.innerHTML = DOMPurify.sanitize(html);
                } else {
                    // Sanitiza√ß√£o manual
                    const sanitized = html
                        .replace(/[\u0000-\u001F\u007F-\u009F]/g, '')
                        .replace(/[\u2028\u2029]/g, '')
                        .replace(/[\u200B-\u200D\uFEFF]/g, '')
                        .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '');
                    
                    container.innerHTML = sanitized;
                }
            } catch (error) {
                console.error('‚ùå Erro ao inserir HTML:', error);
                container.innerHTML = '<div class="error">Erro ao carregar conte√∫do</div>';
            }
        }

        // Fun√ß√£o para escapar HTML (preserva acentos)
        function escapeHTML(str) {
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;');
        }

        function createVideoCard(video) {
            // Exibir texto com escapeHTML (preserva acentos)
            const safeTitulo = escapeHTML(video.titulo || 'V√≠deo');
            const safeHashtags = escapeHTML(video.hashtags || '');
            const safeId = escapeHTML(video.id || 'video');

            // Corrigir caminho do thumbnail
            let safeThumbnailUrl = '';
            if (video.cloudinaryThumbnailUrl) {
                safeThumbnailUrl = escapeHTML(video.cloudinaryThumbnailUrl);
            } else if (video.thumbnailPath) {
                const thumbFileName = video.thumbnailPath.split(/[\\/]/).pop();
                safeThumbnailUrl = escapeHTML(`${API_BASE_URL}/thumbnails/${thumbFileName}`);
            }

            // Corrigir caminho do v√≠deo
            let safeVideoUrl = '';
            if (video.cloudinaryVideoUrl || video.cloudinaryUrl) {
                safeVideoUrl = escapeHTML(video.cloudinaryVideoUrl || video.cloudinaryUrl);
            } else if (video.videoPath) {
                const videoFileName = video.videoPath.split(/[\\/]/).pop();
                const videoTs = video.updatedAt || video.createdAt || Date.now();
                safeVideoUrl = escapeHTML(`${API_BASE_URL}/download/${videoFileName}?ts=${videoTs}`);
            }

            // Passar para atributos JS/HTML usando encodeURIComponent
            const encTitulo = encodeURIComponent(video.titulo || 'V√≠deo');
            const encHashtags = encodeURIComponent(video.hashtags || '');
            const encId = encodeURIComponent(video.id || 'video');
            const encVideoUrl = encodeURIComponent(safeVideoUrl);
            const encThumbnailUrl = encodeURIComponent(safeThumbnailUrl);

            // Debug
            console.log('üîç DEBUG - T√≠tulo original:', video.titulo);
            console.log('üîç DEBUG - T√≠tulo seguro:', safeTitulo);
            console.log('üîç DEBUG - T√≠tulo encoded:', encTitulo);
            console.log('üîç DEBUG - Thumbnail URL:', safeThumbnailUrl);
            console.log('üîç DEBUG - Video URL:', safeVideoUrl);

            return `
                <div class="video-card">
                    <div class="video-thumbnail">
                        ${safeThumbnailUrl ? `<img src="${safeThumbnailUrl}" alt="Thumbnail" style="width:100%;height:100%;object-fit:cover;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">` : `<i class="fas fa-play"></i>`}
                        <div class="video-overlay" style="${safeThumbnailUrl ? 'display: none;' : 'display: flex;'}">
                            <i class="fas fa-play-circle"></i>
                        </div>
                    </div>
                    <div class="video-info">
                        <div class="video-title">${safeTitulo}</div>
                        <div class="video-hashtags">${safeHashtags}</div>
                        ${video.caption ? `<div class="video-caption">${escapeHTML(video.caption)}</div>` : ''}
                    </div>
                    <div class="video-actions">
                        <button class="video-btn primary" onclick="downloadVideoFromGallery('${encVideoUrl}', '${encTitulo}')">
                            <i class="fas fa-download"></i> Baixar
                        </button>
                        <button class="video-btn secondary" onclick="openVideoModal('${encVideoUrl}', '${encId}', '${encTitulo}')">
                            <i class="fas fa-play"></i> Assistir
                        </button>
                        <button class="video-btn secondary" onclick="editVideoMetadata('${encId}', '${encTitulo}', '${encHashtags}')">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="video-btn tiktok" onclick="postToTikTok('${encId}', '${encTitulo}')" id="tiktok-btn-${encId}">
                            <i class="fab fa-tiktok"></i> TikTok
                        </button>
                        <button class="video-btn danger" onclick="deleteVideo('${encId}', '${encTitulo}')">
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                    </div>
                </div>
            `;
        }

        function openVideoModal(encVideoUrl, encId, encTitulo) {
            const videoUrl = decodeURIComponent(encVideoUrl);
            const id = decodeURIComponent(encId);
            const titulo = decodeURIComponent(encTitulo);
            console.log('üéØ CLIQUE NO BOT√ÉO ASSISTIR - URL:', videoUrl, 'id:', id, 'title:', titulo);
            const modal = document.getElementById('videoModal');
            const videoSource = document.getElementById('videoModalSource');
            const videoPlayer = document.getElementById('videoModalPlayer');
            const videoTitleElement = document.getElementById('videoModalTitle');
            const downloadLink = document.getElementById('videoModalDownload');

            // Verificar se os elementos existem
            if (!modal || !videoSource || !videoPlayer) {
                showNotification('Erro ao abrir modal de v√≠deo', 'error');
                return;
            }

            // Para URLs do Cloudinary, usar diretamente
            let finalUrl = videoUrl;
            if (!videoUrl.includes('cloudinary.com')) {
                // Para arquivos locais, adicionar cache busting
                const ts = Date.now();
                finalUrl = videoUrl.includes('?') ? `${videoUrl}&ts=${ts}` : `${videoUrl}?ts=${ts}`;
            }
            
            // Configurar o v√≠deo
            videoSource.src = finalUrl;
            videoPlayer.load();
            videoTitleElement.textContent = titulo;

            // Abrir modal
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
            
            // Scroll para o topo do modal
            modal.scrollTop = 0;
            
            // Adicionar evento para verificar se o v√≠deo carregou
            videoPlayer.addEventListener('loadeddata', function() {
                // V√≠deo carregado com sucesso
            });
            
            videoPlayer.addEventListener('error', function(e) {
                showNotification('Erro ao carregar v√≠deo', 'error');
            });
        }

        function closeVideoModal() {
            const modal = document.getElementById('videoModal');
            const videoPlayer = document.getElementById('videoModalPlayer');
            
            if (videoPlayer) {
                videoPlayer.pause();
                videoPlayer.currentTime = 0; // Reset para o in√≠cio
            }
            
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }

        async function downloadVideoFromGallery(encVideoUrl, encTitulo) {
            const videoUrl = decodeURIComponent(encVideoUrl);
            const titulo = decodeURIComponent(encTitulo);
            console.log('üéØ CLIQUE NO BOT√ÉO BAIXAR - URL:', videoUrl, 'title:', titulo);
            try {
                // Limpar o t√≠tulo para usar como nome do arquivo
                const cleanTitle = titulo.replace(/[^a-zA-Z0-9\s\-_]/g, '').trim();
                const fileName = cleanTitle || 'video';
                
                // Se √© URL do Cloudinary, usar fetch para baixar o arquivo
                if (videoUrl.includes('cloudinary.com')) {
                    showNotification('Baixando v√≠deo...', 'info');
                    
                    // Fazer fetch do v√≠deo com progresso
                    const response = await fetch(videoUrl);
                    if (!response.ok) {
                        throw new Error('Erro ao baixar v√≠deo');
                    }
                    
                    // Verificar se o response tem content-length
                    const contentLength = response.headers.get('content-length');
                    if (contentLength) {
                        const total = parseInt(contentLength, 10);
                        const reader = response.body.getReader();
                        const chunks = [];
                        let receivedLength = 0;
                        
                        while (true) {
                            const { done, value } = await reader.read();
                            
                            if (done) break;
                            
                            chunks.push(value);
                            receivedLength += value.length;
                            
                            // Atualizar progresso a cada 10%
                            const progress = Math.round((receivedLength / total) * 100);
                            if (progress % 10 === 0) {
                                showNotification(`Baixando... ${progress}%`, 'info');
                            }
                        }
                        
                        // Combinar chunks em um blob
                        const blob = new Blob(chunks, { type: 'video/mp4' });
                        
                        // Criar URL do blob
                        const blobUrl = window.URL.createObjectURL(blob);
                        
                        // Criar link de download
                        const a = document.createElement('a');
                        a.href = blobUrl;
                        a.download = `${fileName}.mp4`;
                        a.style.display = 'none';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        
                        // Limpar URL do blob
                        window.URL.revokeObjectURL(blobUrl);
                        
                        showNotification('Download conclu√≠do!', 'success');
                    } else {
                        // Fallback para quando n√£o h√° content-length
                        const blob = await response.blob();
                        const blobUrl = window.URL.createObjectURL(blob);
                        
                        const a = document.createElement('a');
                        a.href = blobUrl;
                        a.download = `${fileName}.mp4`;
                        a.style.display = 'none';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        
                        window.URL.revokeObjectURL(blobUrl);
                        showNotification('Download conclu√≠do!', 'success');
                    }
                } else {
                    // Para arquivos locais, usar m√©todo tradicional
                    const ts = Date.now();
                    const urlWithTs = videoUrl.includes('?') ? `${videoUrl}&ts=${ts}` : `${videoUrl}?ts=${ts}`;
                    const a = document.createElement('a');
                    a.href = urlWithTs;
                    a.download = `${fileName}.mp4`;
                    a.style.display = 'none';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    showNotification('Download iniciado!', 'success');
                }
            } catch (error) {
                console.error('Erro no download:', error);
                showNotification('Erro ao baixar v√≠deo: ' + error.message, 'error');
            }
        }

        async function downloadFromModal() {
            const videoSource = document.getElementById('videoModalSource');
            const videoTitleElement = document.getElementById('videoModalTitle');
            
            if (videoSource && videoSource.src) {
                const videoUrl = videoSource.src;
                const videoTitle = videoTitleElement.textContent;
                await downloadVideoFromGallery(videoUrl, videoTitle);
            } else {
                showNotification('Nenhum v√≠deo dispon√≠vel para download', 'error');
            }
        }

        function copyVideoLink() {
            const videoSource = document.getElementById('videoModalSource');
            if (videoSource && videoSource.src) {
                navigator.clipboard.writeText(videoSource.src).then(() => {
                    showNotification('Link copiado para a √°rea de transfer√™ncia!', 'success');
                }).catch(() => {
                    showNotification('Erro ao copiar link', 'error');
                });
            }
        }

        // Fun√ß√£o para abrir modal de edi√ß√£o
        function editVideoMetadata(encId, encTitulo, encHashtags) {
            const id = decodeURIComponent(encId);
            const titulo = decodeURIComponent(encTitulo);
            const hashtags = decodeURIComponent(encHashtags);
            console.log('üéØ CLIQUE NO BOT√ÉO EDITAR - videoId:', id, 'title:', titulo, 'hashtags:', hashtags);
            // Buscar dados completos do v√≠deo
            fetch(`${API_BASE_URL}/videos/${id}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.video) {
                        const video = data.video;
                        
                        // Preencher formul√°rio
                        document.getElementById('editVideoId').value = video.id;
                        document.getElementById('editVideoTitle').value = video.titulo || titulo;
                        document.getElementById('editVideoHashtags').value = video.hashtags || hashtags;
                        
                        // Preencher legenda
                        const captionElement = document.getElementById('editVideoCaption');
                        if (video.caption) {
                            captionElement.textContent = video.caption;
                        } else {
                            captionElement.innerHTML = '<em>Nenhuma legenda dispon√≠vel</em>';
                        }
                        
                        // Preencher informa√ß√µes do v√≠deo
                        document.getElementById('editVideoTema').textContent = video.tema || 'N/A';
                        document.getElementById('editVideoTipo').textContent = video.tipo || 'N/A';
                        document.getElementById('editVideoPublico').textContent = video.publico || 'N/A';
                        document.getElementById('editVideoFormato').textContent = video.formato || 'N/A';
                        document.getElementById('editVideoCreatedAt').textContent = new Date(video.createdAt).toLocaleString('pt-BR');
                        
                        // Abrir modal
                        document.getElementById('editModal').style.display = 'block';
                        document.body.style.overflow = 'hidden';
                    } else {
                        showNotification('Erro ao carregar dados do v√≠deo', 'error');
                    }
                })
                .catch(error => {
                    showNotification('Erro ao carregar dados do v√≠deo', 'error');
                });
        }

        // Fun√ß√£o para fechar modal de edi√ß√£o
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Fun√ß√£o para salvar altera√ß√µes dos metadados
        async function saveVideoMetadata(event) {
            event.preventDefault();
            
            const videoId = document.getElementById('editVideoId').value;
            const titulo = document.getElementById('editVideoTitle').value.trim();
            const hashtags = document.getElementById('editVideoHashtags').value.trim();
            
            if (!titulo) {
                showNotification('T√≠tulo √© obrigat√≥rio', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/videos/${videoId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ titulo, hashtags })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Metadados atualizados com sucesso!', 'success');
                    closeEditModal();
                    loadVideoGallery(currentVideoPage); // Recarregar galeria na p√°gina atual
                } else {
                    showNotification(data.error || 'Erro ao atualizar metadados', 'error');
                }
            } catch (error) {
                showNotification('Erro ao atualizar metadados', 'error');
            }
        }

        async function postToTikTok(videoId, videoTitle) {
            videoId = decodeURIComponent(videoId);
            videoTitle = decodeURIComponent(videoTitle);
            console.log('üéØ CLIQUE NO BOT√ÉO TIKTOK - id:', videoId, 'title:', videoTitle);
            
            // Verificar se j√° foi postado
            try {
                const statusResponse = await fetch(`${API_BASE_URL}/tiktok/status/${videoId}`);
                const statusData = await statusResponse.json();
                
                if (statusData.success && statusData.tiktokPosted) {
                    showNotification('V√≠deo j√° foi postado no TikTok!', 'info');
                    if (statusData.tiktokUrl) {
                        window.open(statusData.tiktokUrl, '_blank');
                    }
                    return;
                }
            } catch (error) {
                console.error('Erro ao verificar status do TikTok:', error);
            }
            
            // Solicitar access token do TikTok
            const accessToken = prompt('Digite seu Access Token do TikTok:');
            if (!accessToken) {
                showNotification('Access Token √© obrigat√≥rio para postar no TikTok', 'error');
                return;
            }
            
            // Opcional: permitir editar a legenda
            const customCaption = prompt('Legenda para o TikTok (deixe vazio para usar a padr√£o):');
            
            try {
                showNotification('Postando no TikTok...', 'info');
                
                const response = await fetch(`${API_BASE_URL}/tiktok/upload/${videoId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        accessToken: accessToken,
                        customCaption: customCaption || null
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('V√≠deo postado no TikTok com sucesso!', 'success');
                    
                    // Atualizar bot√£o para mostrar que foi postado
                    const tiktokBtn = document.getElementById(`tiktok-btn-${videoId}`);
                    if (tiktokBtn) {
                        tiktokBtn.innerHTML = '<i class="fas fa-check"></i> Postado';
                        tiktokBtn.classList.add('posted');
                        tiktokBtn.onclick = () => {
                            if (data.tiktokUrl) {
                                window.open(data.tiktokUrl, '_blank');
                            }
                        };
                    }
                    
                    // Abrir o v√≠deo no TikTok se a URL estiver dispon√≠vel
                    if (data.tiktokUrl) {
                        setTimeout(() => {
                            if (confirm('Deseja abrir o v√≠deo no TikTok?')) {
                                window.open(data.tiktokUrl, '_blank');
                            }
                        }, 1000);
                    }
                } else {
                    showNotification(data.error || 'Erro ao postar no TikTok', 'error');
                }
            } catch (error) {
                console.error('Erro ao postar no TikTok:', error);
                showNotification('Erro ao postar no TikTok: ' + error.message, 'error');
            }
        }

        async function deleteVideo(videoId, videoTitle) {
            videoId = decodeURIComponent(videoId);
            videoTitle = decodeURIComponent(videoTitle);
            console.log('üéØ CLIQUE NO BOT√ÉO DELETAR - id:', videoId, 'title:', videoTitle);
            if (!confirm(`Tem certeza que deseja deletar o v√≠deo "${videoTitle}"? Esta a√ß√£o n√£o pode ser desfeita.`)) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/videos/${videoId}`, {
                    method: 'DELETE'
                });
                const data = await response.json();

                if (data.success) {
                    showNotification('V√≠deo deletado com sucesso!', 'success');
                    loadVideoGallery(currentVideoPage); // Recarregar galeria na p√°gina atual
                } else {
                    showNotification(data.error || 'Erro ao deletar v√≠deo', 'error');
                }
            } catch (error) {
                showNotification('Erro ao deletar v√≠deo', 'error');
            }
        }

        // Fechar modal de v√≠deo ao clicar fora
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('videoModal');
            if (event.target === modal) {
                closeVideoModal();
            }
        });

        // Fechar modal de v√≠deo com ESC
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeVideoModal();
            }
        });

        // Prevenir que cliques dentro do modal fechem ele
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('videoModal');
            const modalContent = modal ? modal.querySelector('.video-modal-content') : null;
            
            if (modal && modalContent && modalContent.contains(event.target)) {
                event.stopPropagation();
            }
        });

        // Adicionar evento para campo customVideoUrl
        document.addEventListener('DOMContentLoaded', function() {
            const customInput = document.getElementById('customVideoUrl');
            if (customInput) {
                customInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        const url = customInput.value.trim();
                        if (url) {
                            const videoSource = document.getElementById('videoModalSource');
                            const videoPlayer = document.getElementById('videoModalPlayer');
                            const downloadLink = document.getElementById('videoModalDownload');
                            videoSource.src = url;
                            videoPlayer.load();
                            downloadLink.href = url;
                            downloadLink.download = 'video-teste.mp4';
                        }
                    }
                });
            }
            
            // Adicionar evento para formul√°rio de edi√ß√£o
            const editForm = document.getElementById('editVideoForm');
            if (editForm) {
                editForm.addEventListener('submit', saveVideoMetadata);
            }
            
            // Mostrar informa√ß√µes do tipo de v√≠deo ao carregar
            showTipoInfo();
            
                    // Carregar galerias
        loadVideoGallery();
        loadAppImageGallery();
        
        // For√ßar recarregamento do cache
        console.log('üîÑ For√ßando recarregamento do cache...');
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
                for(let registration of registrations) {
                    registration.unregister();
                }
            });
        }
        });

        // Fun√ß√£o para mostrar informa√ß√µes do tipo de v√≠deo selecionado
        function showTipoInfo() {
            const tipoSelect = document.getElementById('videoTipo');
            const tipoInfo = document.getElementById('tipoInfo');
            const tipoNome = document.getElementById('tipoNome');
            const tipoEstrutura = document.getElementById('tipoEstrutura');
            const tipoObjetivo = document.getElementById('tipoObjetivo');
            
            const tiposInfo = {
                anuncio: {
                    nome: "üì¢ VSL/An√∫ncio Publicit√°rio",
                    estrutura: "üéØ Estrutura: Hook ‚Üí Problema ‚Üí Solu√ß√£o ‚Üí Benef√≠cios ‚Üí CTA",
                    objetivo: "üí° Objetivo: Vender o app Baby Diary de forma persuasiva e emocional"
                },
                dica: {
                    nome: "üí° Dica R√°pida e Pr√°tica",
                    estrutura: "üéØ Estrutura: Gancho ‚Üí Dica ‚Üí Exemplo ‚Üí Resultado",
                    objetivo: "üí° Objetivo: Compartilhar conhecimento √∫til de forma direta e acolhedora"
                },
                educativo: {
                    nome: "üìö Conte√∫do Educativo",
                    estrutura: "üéØ Estrutura: Introdu√ß√£o ‚Üí Desenvolvimento ‚Üí Conclus√£o",
                    objetivo: "üí° Objetivo: Ensinar algo novo sobre maternidade de forma did√°tica"
                },
                story: {
                    nome: "üì± Story/Reels para Redes Sociais",
                    estrutura: "üéØ Estrutura: Situa√ß√£o ‚Üí Rea√ß√£o ‚Üí Reflex√£o",
                    objetivo: "üí° Objetivo: Criar identifica√ß√£o e engajamento com conte√∫do real"
                },
                tutorial: {
                    nome: "üéØ Tutorial Passo a Passo",
                    estrutura: "üéØ Estrutura: Objetivo ‚Üí Passos ‚Üí Resultado",
                    objetivo: "üí° Objetivo: Ensinar algo pr√°tico e espec√≠fico de forma clara"
                },
                inspiracional: {
                    nome: "‚ú® Conte√∫do Inspiracional",
                    estrutura: "üéØ Estrutura: Frase ‚Üí Hist√≥ria ‚Üí Reflex√£o",
                    objetivo: "üí° Objetivo: Motivar e emocionar com mensagens de supera√ß√£o"
                }
            };
            
            const tipoSelecionado = tipoSelect.value;
            const info = tiposInfo[tipoSelecionado];
            
            if (info) {
                tipoNome.textContent = info.nome;
                tipoEstrutura.textContent = info.estrutura;
                tipoObjetivo.textContent = info.objetivo;
                tipoInfo.style.display = 'block';
            } else {
                tipoInfo.style.display = 'none';
            }
        }

        // --- FUN√á√ïES DAS IMAGENS DO APP ---
        let appImagesData = [];
        let currentAppImageFilter = 'all';
        let selectedAppImages = [];

        // Inicializar filtros quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar filtro de imagens do app
            currentAppImageFilter = 'all';
        });

        // --- FUN√á√ïES DE SUGEST√ïES INTELIGENTES ---
        
        // Gerar sugest√µes de imagens por cena
        async function generateImageSuggestions() {
            const tema = document.getElementById('tema').value;
            const tipo = document.getElementById('tipo').value;
            const publico = document.getElementById('publico').value;
            const formato = document.getElementById('formato').value;
            const cenas = parseInt(document.getElementById('cenas').value) || 5;
            const resolution = document.getElementById('resolution').value;
            
            if (!tema) {
                alert('Por favor, preencha o tema primeiro!');
                return;
            }

            // Mostrar loading
            const suggestionsContent = document.getElementById('suggestions-content');
            suggestionsContent.innerHTML = '<div style="text-align: center; padding: 20px;"><i class="fas fa-spinner fa-spin"></i> Gerando sugest√µes...</div>';
            document.getElementById('suggestions-result').style.display = 'block';
            document.getElementById('themes-result').style.display = 'none';

            try {
                // Primeiro, gerar o roteiro para obter as cenas
                const scriptResponse = await fetch('/api/generate-video-script', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ publico, duracao: 'medio' })
                });
                
                const scriptData = await scriptResponse.json();
                if (!scriptData.success) {
                    throw new Error('Erro ao gerar roteiro');
                }

                // Dividir o roteiro em cenas
                const cenasArray = splitScriptIntoScenes(scriptData.content, cenas);

                // Gerar sugest√µes de imagens
                const response = await fetch('/api/generate-scene-image-suggestions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        tema,
                        tipo,
                        publico,
                        formato,
                        cenas: cenasArray,
                        resolution
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    displayImageSuggestions(data.suggestions);
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('Erro:', error);
                suggestionsContent.innerHTML = `<div style="color: #ff6b6b; text-align: center; padding: 20px;">
                    <i class="fas fa-exclamation-triangle"></i> Erro ao gerar sugest√µes: ${error.message}
                </div>`;
            }
        }

        // Gerar temas de imagens
        async function generateImageThemes() {
            const tema = document.getElementById('tema').value;
            const tipo = document.getElementById('tipo').value;
            const publico = document.getElementById('publico').value;
            
            if (!tema) {
                alert('Por favor, preencha o tema primeiro!');
                return;
            }

            // Mostrar loading
            const themesContent = document.getElementById('themes-content');
            themesContent.innerHTML = '<div style="text-align: center; padding: 20px;"><i class="fas fa-spinner fa-spin"></i> Gerando temas...</div>';
            document.getElementById('themes-result').style.display = 'block';
            document.getElementById('suggestions-result').style.display = 'none';

            try {
                const response = await fetch('/api/generate-image-themes', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ tema, tipo, publico })
                });

                const data = await response.json();
                
                if (data.success) {
                    displayImageThemes(data.themes);
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('Erro:', error);
                themesContent.innerHTML = `<div style="color: #ff6b6b; text-align: center; padding: 20px;">
                    <i class="fas fa-exclamation-triangle"></i> Erro ao gerar temas: ${error.message}
                </div>`;
            }
        }

        // Exibir sugest√µes de imagens
        function displayImageSuggestions(suggestions) {
            const content = document.getElementById('suggestions-content');
            
            let html = '<div style="display: grid; gap: 15px;">';
            
            suggestions.forEach((suggestion, index) => {
                html += `
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #4CAF50;">
                        <h5 style="color: white; margin-bottom: 8px;">
                            <i class="fas fa-film"></i> Cena ${suggestion.sceneNumber}
                        </h5>
                        <p style="color: rgba(255,255,255,0.9); font-size: 0.9em; margin-bottom: 10px;">
                            <strong>Texto:</strong> ${suggestion.sceneText}
                        </p>
                        <div style="background: rgba(0,0,0,0.2); padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                            <p style="color: #FFD700; font-size: 0.85em; margin-bottom: 5px;"><strong>Prompt para IA:</strong></p>
                            <p style="color: rgba(255,255,255,0.8); font-size: 0.8em; font-style: italic;">${suggestion.imagePrompt}</p>
                        </div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <span style="background: rgba(255,255,255,0.2); padding: 2px 8px; border-radius: 12px; font-size: 0.75em; color: white;">
                                <i class="fas fa-tag"></i> ${suggestion.mood}
                            </span>
                            <span style="background: rgba(255,255,255,0.2); padding: 2px 8px; border-radius: 12px; font-size: 0.75em; color: white;">
                                <i class="fas fa-palette"></i> ${suggestion.style}
                            </span>
                            ${suggestion.suggestedTags.map(tag => `
                                <span style="background: rgba(255,255,255,0.2); padding: 2px 8px; border-radius: 12px; font-size: 0.75em; color: white;">
                                    ${tag}
                                </span>
                            `).join('')}
                        </div>
                        <button class="btn" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); margin-top: 10px; font-size: 0.8em;" onclick="useImageSuggestion(${index})">
                            <i class="fas fa-magic"></i> Usar esta sugest√£o
                        </button>
                    </div>
                `;
            });
            
            html += '</div>';
            content.innerHTML = html;
        }

        // Exibir temas de imagens
        function displayImageThemes(themes) {
            const content = document.getElementById('themes-content');
            
            let html = '<div style="display: grid; gap: 10px;">';
            
            themes.forEach((theme, index) => {
                html += `
                    <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                        <span style="color: white; font-size: 0.9em;">
                            <i class="fas fa-lightbulb"></i> ${theme}
                        </span>
                        <button class="btn" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); font-size: 0.8em;" onclick="useImageTheme('${theme}')">
                            <i class="fas fa-plus"></i> Usar
                        </button>
                    </div>
                `;
            });
            
            html += '</div>';
            content.innerHTML = html;
        }

        // Usar sugest√£o de imagem
        function useImageSuggestion(index) {
            // Aqui voc√™ pode implementar a l√≥gica para usar a sugest√£o
            // Por exemplo, preencher automaticamente campos ou gerar a imagem
            alert(`Sugest√£o ${index + 1} selecionada! Implemente a l√≥gica de uso aqui.`);
        }

        // Usar tema de imagem
        function useImageTheme(theme) {
            // Aqui voc√™ pode implementar a l√≥gica para usar o tema
            // Por exemplo, preencher automaticamente campos ou gerar imagens baseadas no tema
            alert(`Tema "${theme}" selecionado! Implemente a l√≥gica de uso aqui.`);
        }

        // Fun√ß√£o auxiliar para dividir roteiro em cenas
        function splitScriptIntoScenes(script, maxScenes = 5) {
            const cleanScript = script.replace(/\n/g, ' ').replace(/\s+/g, ' ').trim();
            
            if (cleanScript.length < 100) {
                return [cleanScript];
            }
            
            const palavras = cleanScript.split(' ');
            
            if (palavras.length <= maxScenes * 10) {
                return [cleanScript];
            }
            
            const palavrasPorCena = Math.ceil(palavras.length / maxScenes);
            const cenas = [];
            
            for (let i = 0; i < maxScenes; i++) {
                const inicio = i * palavrasPorCena;
                const fim = Math.min((i + 1) * palavrasPorCena, palavras.length);
                
                if (inicio >= palavras.length) break;
                
                const cenaPalavras = palavras.slice(inicio, fim);
                const cena = cenaPalavras.join(' ').trim();
                
                if (cena && !cena.endsWith('.') && !cena.endsWith('!') && !cena.endsWith('?')) {
                    cenas.push(cena + '.');
                } else if (cena) {
                    cenas.push(cena);
                }
            }
            
            return cenas.filter(cena => cena.length > 10).slice(0, maxScenes);
        }

        // Carregar galeria de imagens do app
        async function loadAppImageGallery() {
            const gallery = document.getElementById('appImageGallery');
            gallery.innerHTML = `
                <div class="gallery-loading" style="text-align: center; padding: 40px; color: #666;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2em; margin-bottom: 10px;"></i>
                    <p>Carregando imagens...</p>
                </div>
            `;

            try {
                const response = await fetch(`${API_BASE_URL}/app-images`);
                const data = await response.json();
                
                if (data.success) {
                    appImagesData = data.images;
                    renderAppImageGallery();
                } else {
                    gallery.innerHTML = `
                        <div class="empty-gallery">
                            <i class="fas fa-exclamation-triangle"></i>
                            <h3>Erro ao carregar imagens</h3>
                            <p>${data.error || 'Erro desconhecido'}</p>
                        </div>
                    `;
                }
            } catch (error) {
                gallery.innerHTML = `
                    <div class="empty-gallery">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Erro de conex√£o</h3>
                        <p>Verifique se o servidor est√° rodando.</p>
                    </div>
                `;
            }
        }

        // Renderizar galeria de imagens do app
        function renderAppImageGallery() {
            const gallery = document.getElementById('appImageGallery');
            const filteredImages = filterAppImagesByCategory(appImagesData, currentAppImageFilter);
            
            if (filteredImages.length > 0) {
                const galleryHTML = `
                    <div style="margin-bottom: 15px; color: #666; font-size: 0.9rem;">
                        <i class="fas fa-images"></i> ${filteredImages.length} imagem${filteredImages.length > 1 ? 'ns' : ''} encontrada${filteredImages.length > 1 ? 's' : ''}
                    </div>
                    <div class="app-image-gallery">
                        ${filteredImages.map(image => createAppImageCard(image)).join('')}
                    </div>
                `;
                gallery.innerHTML = galleryHTML;
            } else {
                gallery.innerHTML = `
                    <div class="empty-gallery">
                        <i class="fas fa-images"></i>
                        <h3>Nenhuma imagem encontrada</h3>
                        <p>Adicione imagens do app para ver aqui!</p>
                    </div>
                `;
            }
            // Ap√≥s renderizar a galeria, atualizar preview das imagens selecionadas
            updateSelectedAppImagesPreview();
        }

        // Filtrar imagens por categoria
        function filterAppImages(category) {
            currentAppImageFilter = category;
            
            // Atualizar bot√µes ativos
            document.querySelectorAll('.music-category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderAppImageGallery();
        }

        function filterAppImagesByCategory(images, category) {
            if (category === 'all') return images;
            return images.filter(image => image.tag === category);
        }

        // Criar card de imagem do app
        function createAppImageCard(image) {
            const isSelected = selectedAppImages.includes(image.id);
            const sizeMB = (image.size / (1024 * 1024)).toFixed(1);
            const createdAt = new Date(image.createdAt).toLocaleDateString('pt-BR');
            
            return `
                <div class="app-image-card ${isSelected ? 'selected' : ''}" onclick="toggleAppImageSelection(${image.id})">
                    <img src="${image.cloudinaryUrl}" alt="${image.filename}" class="app-image-thumbnail" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="app-image-thumbnail" style="display: none;">
                        <i class="fas fa-image" style="font-size: 2em; color: #ccc;"></i>
                    </div>
                    <div class="app-image-info">
                        <div class="app-image-title">${image.filename}</div>
                        <span class="app-image-tag">${image.tag}</span>
                        ${image.description ? `<div class="app-image-description">${image.description}</div>` : ''}
                        <div style="font-size: 0.75rem; color: #888; margin-bottom: 10px;">
                            <span><i class="fas fa-hdd"></i> ${sizeMB} MB</span>
                            <span style="margin-left: 10px;"><i class="fas fa-calendar"></i> ${createdAt}</span>
                        </div>
                        <div class="app-image-actions">
                            <button class="app-image-btn secondary" onclick="event.stopPropagation(); viewAppImage('${image.cloudinaryUrl}', '${image.filename}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="app-image-btn danger" onclick="event.stopPropagation(); deleteAppImage(${image.id}, '${image.filename}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Alternar sele√ß√£o de imagem
        function toggleAppImageSelection(imageId) {
            const index = selectedAppImages.indexOf(imageId);
            if (index > -1) {
                selectedAppImages.splice(index, 1);
            } else {
                selectedAppImages.push(imageId);
            }
            renderAppImageGallery();
            updateSelectedAppImagesPreview();
        }

        // Visualizar imagem
        function viewAppImage(imageUrl, filename) {
            window.open(imageUrl, '_blank');
        }

        // Deletar imagem
        async function deleteAppImage(imageId, filename) {
            if (!confirm(`Tem certeza que deseja deletar a imagem "${filename}"?`)) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/app-images/${imageId}`, {
                    method: 'DELETE'
                });
                const data = await response.json();

                if (data.success) {
                    showNotification('Imagem deletada com sucesso!', 'success');
                    loadAppImageGallery();
                } else {
                    showNotification(data.error || 'Erro ao deletar imagem', 'error');
                }
            } catch (error) {
                showNotification('Erro ao deletar imagem', 'error');
            }
        }

        // Upload de imagem do app
        document.getElementById('appImageForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData();
            const fileInput = document.getElementById('appImageFile');
            const tagInput = document.getElementById('appImageTag');
            const descriptionInput = document.getElementById('appImageDescription');
            
            if (!fileInput.files[0]) {
                showNotification('Selecione uma imagem', 'error');
                return;
            }
            
            formData.append('image', fileInput.files[0]);
            formData.append('tag', tagInput.value);
            formData.append('description', descriptionInput.value);
            
            try {
                const response = await fetch(`${API_BASE_URL}/upload-app-image`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Imagem enviada com sucesso!', 'success');
                    document.getElementById('appImageForm').reset();
                    loadAppImageGallery();
                } else {
                    showNotification(data.error || 'Erro ao enviar imagem', 'error');
                }
            } catch (error) {
                showNotification('Erro ao enviar imagem', 'error');
            }
        });

        // [3] Fun√ß√£o para atualizar preview das imagens selecionadas
        function updateSelectedAppImagesPreview() {
            const previewDiv = document.getElementById('selectedAppImagesPreview');
            const listDiv = document.getElementById('selectedAppImagesList');
            if (!previewDiv || !listDiv) return;
            if (selectedAppImages.length === 0) {
                previewDiv.style.display = 'none';
                listDiv.innerHTML = '';
                return;
            }
            previewDiv.style.display = 'block';
            const selectedImages = appImagesData.filter(img => selectedAppImages.includes(img.id));
            listDiv.innerHTML = selectedImages.map(img => `
                <div style="border:1px solid #e1e5e9;border-radius:8px;padding:5px 8px;display:flex;flex-direction:column;align-items:center;max-width:90px;">
                    <img src="${img.cloudinaryUrl}" alt="${img.filename}" style="width:60px;height:60px;object-fit:cover;border-radius:6px;margin-bottom:4px;">
                    <span style="font-size:0.75em;color:#555;">${img.tag}</span>
                </div>
            `).join('');
        }

        // [JS] Fun√ß√µes para sele√ß√£o de imagens do app no formul√°rio de v√≠deo
        // Adicionar ap√≥s defini√ß√£o de appImagesData, selectedAppImages, etc.
        let videoAppImageFilter = 'all';
        function filterAppImagesForVideo(category, btn) {
            videoAppImageFilter = category;
            // Atualizar bot√µes ativos
            const parent = btn.parentNode;
            if (parent) {
                parent.querySelectorAll('.music-category-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            }
            renderVideoAppImageGallery();
        }
        function renderVideoAppImageGallery() {
            const gallery = document.getElementById('videoAppImageGallery');
            if (!gallery) return;
            let filtered = appImagesData;
            if (videoAppImageFilter !== 'all') {
                filtered = appImagesData.filter(img => img.tag === videoAppImageFilter);
            }
            if (filtered.length === 0) {
                gallery.innerHTML = '<div style="color:#888;text-align:center;padding:20px;">Nenhuma imagem encontrada</div>';
                return;
            }
            gallery.innerHTML = filtered.map(img => {
                const isSelected = selectedAppImages.includes(img.id);
                return `
                    <div onclick="toggleAppImageSelection(${img.id})" style="border:2px solid ${isSelected ? '#667eea' : '#e1e5e9'};border-radius:8px;padding:4px;cursor:pointer;box-shadow:0 1px 4px rgba(0,0,0,0.04);background:${isSelected ? '#f0f4ff' : '#fff'};display:flex;flex-direction:column;align-items:center;">
                        <img src="${img.cloudinaryUrl}" alt="${img.filename}" style="width:60px;height:60px;object-fit:cover;border-radius:6px;margin-bottom:2px;">
                        <span style="font-size:0.7em;color:#555;">${img.tag}</span>
                    </div>
                `;
            }).join('');
        }
        // Atualizar galeria de sele√ß√£o de imagens do v√≠deo sempre que appImagesData mudar
        function updateAllAppImageGalleries() {
            renderAppImageGallery(); // galeria de gerenciamento
            renderVideoAppImageGallery(); // galeria de sele√ß√£o do v√≠deo
            updateSelectedAppImagesPreview(); // preview selecionadas
        }
        // Substituir chamadas a renderAppImageGallery() por updateAllAppImageGalleries() onde necess√°rio
        // Exemplo: ap√≥s upload, delete, ou carregamento de imagens

        // Fun√ß√£o para verificar cr√©ditos do ElevenLabs
        async function checkElevenLabsCredits() {
            const button = document.querySelector('.check-credits-btn');
            const creditsInfo = document.getElementById('elevenlabsCreditsInfo');
            
            try {
                // Desabilitar bot√£o durante a verifica√ß√£o
                button.disabled = true;
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verificando...';
                
                // Fazer requisi√ß√£o para verificar cr√©ditos
                const response = await fetch(`${API_BASE_URL}/elevenlabs-credits`);
                const data = await response.json();
                
                if (data.success) {
                    const credits = data.credits;
                    
                    // Preencher informa√ß√µes dos cr√©ditos
                    document.getElementById('elevenlabsEmail').textContent = credits.email;
                    document.getElementById('elevenlabsPlan').textContent = credits.subscription;
                    document.getElementById('elevenlabsUsed').textContent = credits.characterCount.toLocaleString();
                    document.getElementById('elevenlabsLimit').textContent = credits.characterLimit.toLocaleString();
                    document.getElementById('elevenlabsRemaining').textContent = credits.charactersRemaining.toLocaleString();
                    document.getElementById('elevenlabsPercentage').textContent = credits.percentageUsed + '%';
                    
                    // Mostrar se√ß√£o de cr√©ditos
                    creditsInfo.style.display = 'block';
                    
                    // Mostrar notifica√ß√£o de sucesso
                    showNotification('Cr√©ditos verificados com sucesso!', 'success');
                    
                } else {
                    // Mostrar erro
                    showNotification(data.error || 'Erro ao verificar cr√©ditos', 'error');
                    
                    if (!data.hasApiKey) {
                        showNotification('Configure sua API key do ElevenLabs primeiro', 'warning');
                    }
                }
                
            } catch (error) {
                console.error('Erro ao verificar cr√©ditos:', error);
                showNotification('Erro ao verificar cr√©ditos: ' + error.message, 'error');
            } finally {
                // Reabilitar bot√£o
                button.disabled = false;
                button.innerHTML = '<i class="fas fa-credit-card"></i> Verificar Cr√©ditos';
            }
        }

        // Fun√ß√£o para verificar status das APIs
        async function checkApiStatus() {
          try {
            const response = await fetch('/api/status/apis');
            const data = await response.json();
            
            if (data.success) {
              updateApiStatus(data.status);
              updateApiSummary(data.summary);
            } else {
              showNotification('Erro ao verificar status das APIs', 'error');
            }
          } catch (error) {
            console.error('Erro ao verificar status:', error);
            showNotification('Erro ao verificar status das APIs', 'error');
          }
        }

        // Fun√ß√£o para atualizar status individual das APIs
        function updateApiStatus(status) {
          // Gemini
          const geminiElement = document.getElementById('gemini-status');
          const geminiIndicator = geminiElement.querySelector('.api-indicator');
          if (status.gemini.available) {
            geminiIndicator.innerHTML = '‚úÖ Dispon√≠vel';
            geminiIndicator.style.color = '#28a745';
          } else {
            geminiIndicator.innerHTML = `‚ùå Erro: ${status.gemini.error || 'Indispon√≠vel'}`;
            geminiIndicator.style.color = '#dc3545';
          }

          // Groq
          const groqElement = document.getElementById('groq-status');
          const groqIndicator = groqElement.querySelector('.api-indicator');
          if (status.groq.available) {
            groqIndicator.innerHTML = '‚úÖ Dispon√≠vel';
            groqIndicator.style.color = '#28a745';
          } else {
            groqIndicator.innerHTML = `‚ùå Erro: ${status.groq.error || 'Indispon√≠vel'}`;
            groqIndicator.style.color = '#dc3545';
          }

          // OpenAI
          const openaiElement = document.getElementById('openai-status');
          const openaiIndicator = openaiElement.querySelector('.api-indicator');
          if (status.openai.available) {
            openaiIndicator.innerHTML = '‚úÖ Dispon√≠vel';
            openaiIndicator.style.color = '#28a745';
          } else {
            openaiIndicator.innerHTML = `‚ùå Erro: ${status.openai.error || 'Indispon√≠vel'}`;
            openaiIndicator.style.color = '#dc3545';
          }

          // ElevenLabs
          const elevenlabsElement = document.getElementById('elevenlabs-status');
          const elevenlabsIndicator = elevenlabsElement.querySelector('.api-indicator');
          if (status.elevenlabs.available) {
            const credits = status.elevenlabs.credits;
            const used = credits.character_count;
            const limit = credits.character_limit;
            const percentage = Math.round((used / limit) * 100);
            elevenlabsIndicator.innerHTML = `‚úÖ Dispon√≠vel (${percentage}% usado)`;
            elevenlabsIndicator.style.color = percentage > 80 ? '#ffc107' : '#28a745';
          } else {
            elevenlabsIndicator.innerHTML = `‚ùå Erro: ${status.elevenlabs.error || 'Indispon√≠vel'}`;
            elevenlabsIndicator.style.color = '#dc3545';
          }
        }

        // Fun√ß√£o para atualizar resumo das APIs
        function updateApiSummary(summary) {
          const summaryElement = document.getElementById('api-summary');
          const availableCount = summary.available_apis;
          const totalCount = summary.total_apis;
          
          if (availableCount === 0) {
            summaryElement.innerHTML = '‚ö†Ô∏è Nenhuma API dispon√≠vel. O sistema usar√° fallback local.';
            summaryElement.style.color = '#dc3545';
          } else if (availableCount === totalCount) {
            summaryElement.innerHTML = `‚úÖ Todas as ${totalCount} APIs est√£o funcionando perfeitamente!`;
            summaryElement.style.color = '#28a745';
          } else {
            summaryElement.innerHTML = `‚ö†Ô∏è ${availableCount} de ${totalCount} APIs dispon√≠veis. Sistema funcionando com fallback.`;
            summaryElement.style.color = '#ffc107';
          }
        }

        // Fun√ß√£o para verificar uso de tokens das APIs
        async function checkTokenUsage() {
          try {
            const response = await fetch('/api/usage/tokens');
            const data = await response.json();
            
            if (data.success) {
              updateTokenUsage(data.usage);
              showNotification('Uso de tokens verificado com sucesso!', 'success');
            } else {
              showNotification('Erro ao verificar uso de tokens', 'error');
            }
          } catch (error) {
            console.error('Erro ao verificar uso de tokens:', error);
            showNotification('Erro ao verificar uso de tokens', 'error');
          }
        }

        // Fun√ß√£o para atualizar informa√ß√µes de uso de tokens
        function updateTokenUsage(usage) {
          // Gemini
          const geminiUsage = document.getElementById('gemini-usage');
          if (usage.gemini.usage) {
            if (usage.gemini.usage.status === 'Quota Excedida') {
              geminiUsage.innerHTML = `‚ö†Ô∏è ${usage.gemini.usage.status}<br><small>${usage.gemini.usage.note}</small>`;
              geminiUsage.style.borderLeftColor = '#dc3545';
            } else {
              geminiUsage.innerHTML = `‚úÖ ${usage.gemini.usage.status}<br><small>${usage.gemini.usage.note}</small>`;
              geminiUsage.style.borderLeftColor = '#28a745';
            }
          } else if (usage.gemini.error) {
            geminiUsage.innerHTML = `‚ùå Erro: ${usage.gemini.error}`;
            geminiUsage.style.borderLeftColor = '#dc3545';
          }

          // Groq
          const groqUsage = document.getElementById('groq-usage');
          if (usage.groq.usage) {
            if (usage.groq.usage.status === 'Rate Limit') {
              groqUsage.innerHTML = `‚ö†Ô∏è ${usage.groq.usage.status}<br><small>${usage.groq.usage.note}</small>`;
              groqUsage.style.borderLeftColor = '#ffc107';
            } else {
              groqUsage.innerHTML = `‚úÖ ${usage.groq.usage.status}<br><small>${usage.groq.usage.note}</small>`;
              groqUsage.style.borderLeftColor = '#28a745';
            }
          } else if (usage.groq.error) {
            groqUsage.innerHTML = `‚ùå Erro: ${usage.groq.error}`;
            groqUsage.style.borderLeftColor = '#dc3545';
          }

          // OpenAI
          const openaiUsage = document.getElementById('openai-usage');
          if (usage.openai.usage) {
            if (usage.openai.usage.status === 'Rate Limit') {
              openaiUsage.innerHTML = `‚ö†Ô∏è ${usage.openai.usage.status}<br><small>${usage.openai.usage.note}</small>`;
              openaiUsage.style.borderLeftColor = '#ffc107';
            } else if (usage.openai.usage.total_usage) {
              const totalUsage = usage.openai.usage.total_usage;
              const dailyCosts = usage.openai.usage.daily_costs;
              openaiUsage.innerHTML = `‚úÖ ${usage.openai.usage.status}<br><small>Uso total: ${totalUsage} tokens<br>${dailyCosts ? `Custo di√°rio: $${dailyCosts}` : ''}</small>`;
              openaiUsage.style.borderLeftColor = '#28a745';
            } else {
              openaiUsage.innerHTML = `‚úÖ ${usage.openai.usage.status}`;
              openaiUsage.style.borderLeftColor = '#28a745';
            }
          } else if (usage.openai.error) {
            openaiUsage.innerHTML = `‚ùå Erro: ${usage.openai.error}`;
            openaiUsage.style.borderLeftColor = '#dc3545';
          }
        }

        // Verificar status das APIs ao carregar a p√°gina
        document.addEventListener('DOMContentLoaded', function() {
          checkApiStatus();
          checkTokenUsage();
        });

    </script>
</body>
</html> 